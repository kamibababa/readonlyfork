{"version":3,"mappings":"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","names":["globalLang","reactive","initialized","useGlobalLang","initialTag","tag","watch","value","globalTheme","oldValue","initialThemeName","useGlobalTheme","lang","theme","happyHacking","blur","target","focus","onClickOutside","useOnClickOutside","props","__props","currentURL","currentOrigin","route","useRoute","origin","formSubmit","form","event","action","assignValuesFromEvent","error","values","key","useForm","router","useRouter","submit","url","indent","computed","_a","slug","text","headlineElement","ref","headlineId","formatNode","hovered","jumpToHeadline","scrollForHash","hash","nextTick","scrollIntoView","safeHtml","html","sanitizeHtml","who","nodes","parse","elementPlugin","element","plugin","isElement","highlightedHtml","hljs","onMounted","__vitePreload","noHighlight","softLineBreakElement","needBreak","previousChar","previousElement","isCJKAndFullwidthPunctuation","char","isExternalLink","link","stateResolveLink","state","components","Paragraph","Table","Headline","ThematicBreak","HtmlBlock","CodeBlock","BlockQuote","List","Item","OrderedList","OrderedItem","Emphasis","Strong","HardLineBreak","SoftLineBreak","Link","FootnoteRef","Image","Code","HtmlInline","Text","component","leftPad","line","size","formatDate","t","YYYY","MM","DD","formatTime","opts","hh","mm","ss","mi","formatDateTime","date","time","normalizeAttributes","attributes","title","subtitle","translators","authors","keywords","venue","normalizeDate","parsed","names","showAttributes","keys","name","Default","Dedication","Activity","ElementPlugin","propsBuilder","authorAvatarURL","author","join","AuthorContactSchema","z","AuthorConfigSchema","loadAuthorConfig","json","loadAuthor","avatarURL","documentTitle","document","firstHeadline","documentFirstHeadline","node","loadConfig","parseDocument","stateRefresh","config","store","Kv.createStore","Kv.set","stateLoad","options","cachedConfig","Kv.get","watchEffect","plugins","Plugins.ElementPlugin","markRaw","Readonlylink","ctx","Mimor","stateCreate","kind","stateIsMarkdown","globalHistory","useHistory","record","sortGlobalHistoryRecord","entries","x","y","stringTrimEnd","input","pattern","prefix","response","contentType","history","newState","stateTitle","stateLoadFromCacheFirst","cached","useDefaultAuthorList","promiseAllFulfilled","promises","results","result","list","cachedAuthors","activityURL","sortActivities","activities","comparisonFromBoolean","p","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","globalFollowing","listText","useFollowing","loadList","following","isFollowed","follow","unfollow","stateCurrentDocument","currentQuery","qs","stateReactivelyUpdateRoute","isValidDate","loadActivity","path","loadActivitiesFromAuthors","loadActivitiesFromAuthor","paths","texts","documents","useStateOptions","statePaths","stateNextPath","index","statePrevPath","topElement","BookConfigSchema","loadBookConfig","frontMatter","useEventListener","stateListenMessage","stateListen","save","isCurrentAuthor","toggle","stateActivitiesForShow","activity","stateReactivelyUpdateActivities","stateReactivelyUpdateAuthors","stateWatch","cachedActivities","showNav","slotElement","slotElementMobile","ManualConfigSchema","loadManualConfig","currentDocument","routes","Home","About","AuthorList","Author","ArticleEntrance","Article","EmbeddedArticle","BookEntrance","Book","ManualEntrance","Manual","History","Following","PageNotFound","createRouter","createWebHistory","app","createApp","App","createHead","Directives.focus","Directives.blur","Directives.onClickOutside"],"ignoreList":[],"sources":["../../src/components/lang/useGlobalLang.ts","../../src/models/theme/globalTheme.ts","../../src/models/theme/initialThemeName.ts","../../src/models/theme/useGlobalTheme.ts","../../src/App.vue","../../src/console/happyHacking.ts","../../src/directives/blur.ts","../../src/directives/focus.ts","../../src/directives/onClickOutside.ts","../../src/components/lang/Lang.vue","../../src/layouts/page-layout/PageFoot.vue","../../src/components/utils/Hyperlink.vue","../../src/utils/currentURL.ts","../../src/utils/currentOrigin.ts","../../src/layouts/page-layout/PageMenu.vue","../../src/layouts/page-layout/PageLayout.vue","../../src/pages/about/About.vue","../../src/components/form/formSubmit.ts","../../src/components/form/useForm.ts","../../src/pages/article-entrance/ArticleEntrance.vue","../../src/components/md/nodes/leaf-blocks/MdParagraph.vue","../../src/utils/slug.ts","../../src/components/md/nodes/leaf-blocks/MdHeadline.vue","../../src/utils/safeHtml.ts","../../src/components/md/nodes/leaf-blocks/MdHtmlBlock.vue","../../src/components/highlight/Highlight.vue","../../src/components/md/nodes/leaf-blocks/MdCodeBlock.vue","../../src/components/md/nodes/inlines/MdSoftLineBreak.vue","../../src/components/md/isExternalLink.ts","../../src/components/md/stateResolveLink.ts","../../src/components/md/nodes/inlines/MdHtmlInline.vue","../../src/components/md/nodes/index.ts","../../src/components/md/MdNode.vue","../../src/utils/leftPad.ts","../../src/utils/formatDate.ts","../../src/components/md/normalizeAttributes.ts","../../src/components/md/pages/default/MdDefaultAttributes.vue","../../src/components/md/pages/default/MdDefaultTitle.vue","../../src/components/md/pages/default/MdDefault.vue","../../src/components/md/pages/index.ts","../../src/components/md/Plugin.ts","../../src/md-plugins/mimor/Mimor.vue","../../src/md-plugins/readonlylink/ReadonlylinkArticle.vue","../../src/models/author/authorAvatarURL.ts","../../src/models/author/AuthorContact.ts","../../src/models/author/AuthorConfig.ts","../../src/models/author/loadAuthorConfig.ts","../../src/models/author/loadAuthor.ts","../../src/md-plugins/readonlylink/ReadonlylinkAuthor.vue","../../src/components/md/documentTitle.ts","../../src/md-plugins/readonlylink/loadConfig.ts","../../src/md-plugins/readonlylink/stateRefresh.ts","../../src/md-plugins/readonlylink/ReadonlylinkLoaded.vue","../../src/md-plugins/readonlylink/stateLoad.ts","../../src/md-plugins/readonlylink/Readonlylink.vue","../../src/md-plugins/index.ts","../../src/components/md/stateCreate.ts","../../src/components/md/MdPage.vue","../../src/pages/article/ArticleMarkdown.vue","../../src/pages/article/ArticlePlaintext.vue","../../src/pages/article/stateIsMarkdown.ts","../../src/models/history/useHistory.ts","../../src/utils/stringTrimEnd.ts","../../src/pages/article/stateLoad.ts","../../src/pages/article/stateRefresh.ts","../../src/pages/article/stateTitle.ts","../../src/pages/article/ArticleLoaded.vue","../../src/pages/article/stateLoadFromCacheFirst.ts","../../src/pages/article/Article.vue","../../src/models/author-list/useDefaultAuthorList.ts","../../src/utils/promiseAllFulfilled.ts","../../src/pages/author-list/stateRefresh.ts","../../src/pages/author-list/AuthorListLoaded.vue","../../src/pages/author-list/stateLoad.ts","../../src/pages/author-list/AuthorList.vue","../../src/components/activity/Activity.vue","../../src/models/activity/sortActivities.ts","../../src/pages/author/AuthorAvatar.vue","../../src/components/icons/BilibiliLineIcon.vue","../../src/components/icons/GithubIcon.vue","../../src/components/icons/MimorIcon.vue","../../src/components/icons/TwitterIcon.vue","../../src/models/following/globalFollowing.ts","../../src/models/following/useFollowing.ts","../../src/pages/author/AuthorMenu.vue","../../src/pages/author/AuthorTabbar.vue","../../src/pages/author/AuthorPage.vue","../../src/pages/author/stateCurrentDocument.ts","../../src/pages/author/stateReactivelyUpdateRoute.ts","../../src/utils/isValidDate.ts","../../src/models/activity/loadActivity.ts","../../src/models/activity/loadActivitiesFromAuthors.ts","../../src/pages/author/stateLoad.ts","../../src/pages/author/stateRefresh.ts","../../src/pages/author/stateTitle.ts","../../src/pages/author/AuthorLoaded.vue","../../src/pages/author/stateLoadFromCacheFirst.ts","../../src/pages/author/Author.vue","../../src/pages/book-entrance/BookEntrance.vue","../../src/pages/book/BookContents.vue","../../src/pages/book/statePaths.ts","../../src/pages/book/stateNextPath.ts","../../src/pages/book/statePrevPath.ts","../../src/pages/book/BookPage.vue","../../src/pages/book/BookTitlePage.vue","../../src/pages/book/stateCurrentDocument.ts","../../src/models/book/BookConfig.ts","../../src/models/book/loadBookConfig.ts","../../src/pages/book/stateLoad.ts","../../src/pages/book/stateRefresh.ts","../../src/pages/book/stateTitle.ts","../../src/pages/book/BookLoaded.vue","../../src/pages/book/stateLoadFromCacheFirst.ts","../../src/pages/book/Book.vue","../../src/pages/embedded-article/stateListenMessage.ts","../../src/pages/embedded-article/stateListen.ts","../../src/pages/embedded-article/EmbeddedArticle.vue","../../src/pages/errors/PageNotFound.vue","../../src/pages/following/FollowingEditor.vue","../../src/pages/following/FollowingAuthor.vue","../../src/pages/following/stateActivitiesForShow.ts","../../src/pages/following/stateReactivelyUpdateActivities.ts","../../src/pages/following/stateReactivelyUpdateAuthors.ts","../../src/pages/following/stateReactive.ts","../../src/pages/following/FollowingLoaded.vue","../../src/pages/following/stateRefresh.ts","../../src/pages/following/stateLoad.ts","../../src/pages/following/Following.vue","../../src/pages/history/HistoryEntry.vue","../../src/pages/history/HistoryLoaded.vue","../../src/pages/history/stateLoad.ts","../../src/pages/history/History.vue","../../src/pages/home/stateRefresh.ts","../../src/pages/home/HomeLoaded.vue","../../src/pages/home/stateLoad.ts","../../src/pages/home/Home.vue","../../src/pages/manual-entrance/ManualEntrance.vue","../../src/pages/manual/ManualLayout.vue","../../src/pages/manual/statePaths.ts","../../src/pages/manual/stateNextPath.ts","../../src/pages/manual/statePrevPath.ts","../../src/pages/manual/ManualPage.vue","../../src/pages/manual/stateCurrentDocument.ts","../../src/pages/manual/stateReactivelyUpdateRoute.ts","../../src/models/manual/ManualConfig.ts","../../src/models/manual/loadManualConfig.ts","../../src/pages/manual/stateLoad.ts","../../src/pages/manual/stateRefresh.ts","../../src/pages/manual/stateTitle.ts","../../src/pages/manual/ManualLoaded.vue","../../src/pages/manual/stateLoadFromCacheFirst.ts","../../src/pages/manual/Manual.vue","../../src/pages/routes.ts","../../src/router/index.ts","../../src/main.ts"],"sourcesContent":["import { reactive, watch } from 'vue'\r\n\r\ntype Lang = {\r\n  knownTags: Array<string>\r\n  tag: string\r\n  isZh(): boolean\r\n  isEn(): boolean\r\n}\r\n\r\nconst globalLang: Lang = reactive({\r\n  knownTags: ['zh', 'en'],\r\n  tag: 'en',\r\n\r\n  isZh() {\r\n    return this.tag.startsWith('zh')\r\n  },\r\n\r\n  isEn() {\r\n    return !this.isZh()\r\n  },\r\n})\r\n\r\nlet initialized = false\r\n\r\nexport function useGlobalLang(): Lang {\r\n  if (initialized) {\r\n    return globalLang\r\n  }\r\n\r\n  globalLang.tag = initialTag()\r\n\r\n  initialized = true\r\n\r\n  return globalLang\r\n}\r\n\r\nfunction initialTag(): string {\r\n  const tag = window.localStorage.getItem('lang')\r\n  if (tag) {\r\n    return tag\r\n  }\r\n\r\n  if (window.navigator.language.startsWith('zh')) {\r\n    return 'zh'\r\n  }\r\n\r\n  return 'en'\r\n}\r\n\r\nwatch(\r\n  () => globalLang.tag,\r\n  (value) => {\r\n    window.localStorage.setItem('lang', value)\r\n  },\r\n)\r\n\r\nexport function langTagName(tag: string): string {\r\n  switch (tag) {\r\n    case 'zh':\r\n      return '中文'\r\n    case 'en':\r\n      return 'English'\r\n    default:\r\n      return 'English'\r\n  }\r\n}\r\n","import { reactive, watch } from 'vue'\r\nimport { Theme } from './Theme'\r\n\r\nexport const globalTheme: Theme = reactive({\r\n  name: 'system',\r\n  knownThemeNames: ['system', 'light', 'dark'],\r\n})\r\n\r\nwatch(\r\n  () => globalTheme.name,\r\n  (value, oldValue) => {\r\n    if (oldValue) {\r\n      document.documentElement.classList.remove(oldValue)\r\n    }\r\n\r\n    if (value === 'system') {\r\n      window.localStorage.removeItem('theme')\r\n    } else {\r\n      window.localStorage.setItem('theme', value)\r\n      document.documentElement.classList.add(value)\r\n    }\r\n  },\r\n)\r\n","export function initialThemeName(): string {\r\n  if (\r\n    window.localStorage.getItem('theme') === 'dark' ||\r\n    (!window.localStorage.getItem('theme') &&\r\n      window.matchMedia('(prefers-color-scheme: dark)').matches)\r\n  ) {\r\n    document.documentElement.classList.add('dark')\r\n    return 'dark'\r\n  } else {\r\n    document.documentElement.classList.remove('dark')\r\n    return 'system'\r\n  }\r\n}\r\n","import { Theme } from './Theme'\r\nimport { globalTheme } from './globalTheme'\r\nimport { initialThemeName } from './initialThemeName'\r\n\r\nlet initialized = false\r\n\r\nexport function useGlobalTheme(): Theme {\r\n  if (initialized) return globalTheme\r\n\r\n  globalTheme.name = initialThemeName()\r\n  initialized = true\r\n  return globalTheme\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Head } from '@vueuse/head'\r\nimport { useGlobalLang } from './components/lang/useGlobalLang'\r\nimport { useGlobalTheme } from './models/theme'\r\n\r\nconst lang = useGlobalLang()\r\nconst theme = useGlobalTheme()\r\n</script>\r\n\r\n<template>\r\n  <Head>\r\n    <title v-if=\"lang.isZh()\">Readonly</title>\r\n    <title v-else>Readonly</title>\r\n\r\n    <meta v-if=\"theme.name === 'light'\" name=\"theme-color\" content=\"white\" />\r\n    <meta v-if=\"theme.name === 'dark'\" name=\"theme-color\" content=\"black\" />\r\n  </Head>\r\n\r\n  <RouterView />\r\n</template>\r\n","export function happyHacking(): void {\r\n  console.group('From readonly.link developers:')\r\n  console.log(`Welcome to the console of readonly.link :)`)\r\n  console.log(`This project is open source.`)\r\n  console.log(\r\n    `The source code is at https://github.com/readonlylink/readonlylink`,\r\n  )\r\n  console.log(`The source map is included.`)\r\n  console.log(`Happy hacking!`)\r\n  console.groupEnd()\r\n}\r\n","import { Directive } from 'vue'\r\n\r\nexport const blur: Directive = {\r\n  mounted: (target) => target.blur(),\r\n}\r\n","import { Directive } from 'vue'\r\n\r\nexport const focus: Directive = {\r\n  mounted: (target) => target.focus(),\r\n}\r\n","import { onClickOutside as useOnClickOutside } from '@vueuse/core'\r\nimport { Directive } from 'vue'\r\n\r\nexport const onClickOutside: Directive = {\r\n  mounted: (target, { value }) => useOnClickOutside(target, value),\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { useGlobalLang } from './useGlobalLang'\r\n\r\nconst lang = useGlobalLang()\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <slot v-if=\"lang.isZh()\" name=\"zh\"></slot>\r\n    <slot v-if=\"lang.isEn()\" name=\"en\"></slot>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\n\r\nconst lang = useGlobalLang()\r\n</script>\r\n\r\n<template>\r\n  <div class=\"text-sm\">\r\n    <Lang>\r\n      <template #zh>\r\n        <a href=\"https://xieyuheng.com\" target=\"_blank\"> 谢宇恒软件工作室 </a>\r\n      </template>\r\n      <template #en>\r\n        <a href=\"https://xieyuheng.com\" target=\"_blank\">\r\n          Xie Yuheng Software Studio\r\n        </a>\r\n      </template>\r\n    </Lang>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\n/*\r\n\r\n   We use our custom <Hyperlink> instead of <RouterLink>,\r\n   so that we can add some behaviors to every links.\r\n\r\n */\r\n\r\nconst props = defineProps<{\r\n  href: string\r\n}>()\r\n</script>\r\n\r\n<template>\r\n  <RouterLink v-bind=\"props\" :to=\"props.href\"><slot /></RouterLink>\r\n</template>\r\n","export function currentURL() {\r\n  return new URL(window.location.href)\r\n}\r\n","import { currentURL } from './currentURL'\r\n\r\nexport function currentOrigin() {\r\n  const url = currentURL()\r\n  return url.origin\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { ArrowTopRightOnSquareIcon } from '@heroicons/vue/24/outline'\r\nimport { useRoute } from 'vue-router'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { useGlobalTheme } from '../../models/theme'\r\nimport { currentOrigin } from '../../utils/currentOrigin'\r\n\r\nconst route = useRoute()\r\nconst origin = currentOrigin()\r\nconst theme = useGlobalTheme()\r\nconst lang = useGlobalLang()\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-wrap text-stone-400\">\r\n    <div class=\"flex flex-col items-start space-y-1 pb-6 pr-8\">\r\n      <button\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        @click=\"lang.isZh() ? (lang.tag = 'en') : (lang.tag = 'zh')\"\r\n      >\r\n        <Lang>\r\n          <template #zh>中文/English</template>\r\n          <template #en>English/中文</template>\r\n        </Lang>\r\n      </button>\r\n\r\n      <button\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        @click=\"\r\n          theme.name !== 'dark' ? (theme.name = 'dark') : (theme.name = 'light')\r\n        \"\r\n      >\r\n        <Lang>\r\n          <template #zh>\r\n            <span v-if=\"theme.name === 'dark'\">深色/浅色</span>\r\n            <span v-else>浅色/深色</span>\r\n          </template>\r\n          <template #en>\r\n            <span v-if=\"theme.name === 'dark'\">Dark/Light</span>\r\n            <span v-else>Light/Dark</span>\r\n          </template>\r\n        </Lang>\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"flex flex-col items-start space-y-1 pb-6 pr-8\">\r\n      <Hyperlink\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        :class=\"{ 'text-black dark:text-white': route.path === '/' }\"\r\n        href=\"/\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 首页 </template>\r\n          <template #en> Homepage </template>\r\n        </Lang>\r\n      </Hyperlink>\r\n\r\n      <Hyperlink\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        :class=\"{ 'text-black dark:text-white': route.path === '/authors' }\"\r\n        href=\"/authors\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 作者 </template>\r\n          <template #en> Authors </template>\r\n        </Lang>\r\n      </Hyperlink>\r\n\r\n      <Hyperlink\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        :class=\"{ 'text-black dark:text-white': route.path === '/following' }\"\r\n        href=\"/following\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 关注 </template>\r\n          <template #en> Following </template>\r\n        </Lang>\r\n      </Hyperlink>\r\n\r\n      <Hyperlink\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        :class=\"{ 'text-black dark:text-white': route.path === '/history' }\"\r\n        href=\"/history\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 历史 </template>\r\n          <template #en> History </template>\r\n        </Lang>\r\n      </Hyperlink>\r\n    </div>\r\n\r\n    <div class=\"flex flex-col items-start space-y-1 pb-6 pr-8\">\r\n      <a\r\n        :href=\"\r\n          lang.isZh()\r\n            ? `${origin}/manuals/${origin}/contents/manual/zh.json`\r\n            : `${origin}/manuals/${origin}/contents/manual/en.json`\r\n        \"\r\n        class=\"flex items-center hover:text-black dark:hover:text-white\"\r\n        :class=\"{ 'text-black dark:text-white': route.path === '/docs' }\"\r\n        target=\"_blank\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 手册 </template>\r\n          <template #en> Manual </template>\r\n        </Lang>\r\n\r\n        <ArrowTopRightOnSquareIcon class=\"ml-0.5 h-4 w-4\" />\r\n      </a>\r\n\r\n      <Hyperlink\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        :class=\"{ 'text-black dark:text-white': route.path === '/about' }\"\r\n        href=\"/about\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 关于 </template>\r\n          <template #en> About </template>\r\n        </Lang>\r\n      </Hyperlink>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Head } from '@vueuse/head'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport PageFoot from './PageFoot.vue'\r\nimport PageHead from './PageHead.vue'\r\n\r\nconst lang = useGlobalLang()\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"h-screen-dynamic overflow-auto bg-white text-black dark:bg-black dark:text-white\"\r\n  >\r\n    <Head>\r\n      <title v-if=\"lang.isZh()\">只读</title>\r\n      <title v-else>Readonly</title>\r\n    </Head>\r\n\r\n    <div\r\n      class=\"mx-auto flex h-full min-h-full max-w-3xl flex-col justify-between px-3 py-3 text-xl sm:px-6 sm:py-4\"\r\n    >\r\n      <div>\r\n        <PageHead />\r\n\r\n        <div class=\"flex flex-col\">\r\n          <slot />\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"pt-20\">\r\n        <PageFoot class=\"border-t border-black py-2 dark:border-white\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { ArrowTopRightOnSquareIcon } from '@heroicons/vue/24/outline'\r\nimport { Head } from '@vueuse/head'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\n\r\nconst lang = useGlobalLang()\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <Head>\r\n      <title v-if=\"lang.isZh()\">关于 | 只读</title>\r\n      <title v-else>About | Readonly</title>\r\n    </Head>\r\n\r\n    <div class=\"flex items-baseline space-x-4\">\r\n      <div class=\"text-2xl font-bold\">\r\n        <Lang>\r\n          <template #zh> 关于 </template>\r\n          <template #en> About </template>\r\n        </Lang>\r\n      </div>\r\n    </div>\r\n\r\n    <main class=\"space-y-3 py-4\">\r\n      <Lang\r\n        class=\"inline-flex flex-wrap items-baseline bg-white text-black dark:bg-black dark:text-white\"\r\n      >\r\n        <template #zh>\r\n          <div class=\"pr-1 font-bold\">只读链接</div>\r\n          <div>是一个文档渲染工具，</div>\r\n          <div>文字创作者的社区。</div>\r\n        </template>\r\n        <template #en>\r\n          <div class=\"pr-1 font-bold\">Readonly.Link</div>\r\n          <div class=\"pr-1\">is a document rendering tool,</div>\r\n          <div>and a community for authors.</div>\r\n        </template>\r\n      </Lang>\r\n\r\n      <Lang>\r\n        <template #zh>\r\n          项目在 2021 年末由\r\n          <a\r\n            href=\"https://xieyuheng.com\"\r\n            class=\"inline-flex items-center underline\"\r\n            target=\"_blank\"\r\n          >\r\n            谢宇恒\r\n            <ArrowTopRightOnSquareIcon\r\n              class=\"w-4 shrink-0 text-stone-500 dark:text-stone-400\"\r\n            />\r\n          </a>\r\n          发起。\r\n        </template>\r\n        <template #en>\r\n          The project was founded by\r\n          <a\r\n            href=\"https://xieyuheng.com\"\r\n            class=\"inline-flex items-center underline\"\r\n            target=\"_blank\"\r\n          >\r\n            Xie Yuheng\r\n            <ArrowTopRightOnSquareIcon\r\n              class=\"w-4 shrink-0 text-stone-500 dark:text-stone-400\"\r\n            />\r\n          </a>\r\n          at the end of 2021.\r\n        </template>\r\n      </Lang>\r\n\r\n      <Lang>\r\n        <template #zh>\r\n          有时候，我只想把我写的文章分享给朋友，不想有任何纷扰。\r\n        </template>\r\n        <template #en>\r\n          Sometimes, I just want to share my articles to my friends, without any\r\n          distractions.\r\n        </template>\r\n      </Lang>\r\n\r\n      <Lang>\r\n        <template #zh>\r\n          在设计自己用的解决方案时，也能作一个网络服务让大家都能用。\r\n        </template>\r\n        <template #en>\r\n          When designing a solution for myself, I can also build it as a web\r\n          service for others.\r\n        </template>\r\n      </Lang>\r\n\r\n      <Lang>\r\n        <template #zh> 何乐而不为呢？ </template>\r\n        <template #en> I am glad to do so. </template>\r\n      </Lang>\r\n\r\n      <div class=\"flex items-baseline space-x-4\">\r\n        <div class=\"text-2xl font-bold\">\r\n          <Lang>\r\n            <template #zh> 开源 </template>\r\n            <template #en> Open source </template>\r\n          </Lang>\r\n        </div>\r\n      </div>\r\n\r\n      <Lang>\r\n        <template #zh>\r\n          <a\r\n            href=\"https://github.com/readonlylink/readonlylink\"\r\n            class=\"inline-flex items-center underline\"\r\n            target=\"_blank\"\r\n            >源代码<ArrowTopRightOnSquareIcon\r\n              class=\"w-4 shrink-0 text-stone-500 dark:text-stone-400\" /></a\r\n          >。\r\n        </template>\r\n        <template #en>\r\n          <a\r\n            href=\"https://github.com/readonlylink/readonlylink\"\r\n            class=\"inline-flex items-center underline\"\r\n            target=\"_blank\"\r\n          >\r\n            Source code\r\n            <ArrowTopRightOnSquareIcon\r\n              class=\"w-4 shrink-0 text-stone-500 dark:text-stone-400\" /></a\r\n          >.\r\n        </template>\r\n      </Lang>\r\n\r\n      <div class=\"flex items-baseline space-x-4\">\r\n        <div class=\"text-2xl font-bold\">\r\n          <Lang>\r\n            <template #zh> 口号 </template>\r\n            <template #en> Slogan </template>\r\n          </Lang>\r\n        </div>\r\n      </div>\r\n\r\n      <Lang>\r\n        <template #zh> 我们的口号是： </template>\r\n        <template #en> Our slogan is: </template>\r\n      </Lang>\r\n\r\n      <Lang class=\"font-bold text-stone-500 dark:text-stone-400\">\r\n        <template #zh>\r\n          <div>\r\n            分享<span class=\"text-black dark:text-white\">只读</span>链接，<br\r\n              class=\"sm:hidden\"\r\n            /><span class=\"text-black dark:text-white\">只</span>为享受阅<span\r\n              class=\"text-black\"\r\n              >读</span\r\n            >。\r\n          </div>\r\n        </template>\r\n        <template #en>\r\n          <div>\r\n            <span class=\"text-black dark:text-white\">Readonly</span> links,\r\n            <br class=\"sm:hidden\" />\r\n            for your <span class=\"text-black dark:text-white\">read only</span>.\r\n          </div>\r\n        </template>\r\n      </Lang>\r\n\r\n      <Lang>\r\n        <template #zh> 耶！ </template>\r\n        <template #en> Yeah! </template>\r\n      </Lang>\r\n    </main>\r\n  </PageLayout>\r\n</template>\r\n","import { Form, FormValues } from './Form'\r\n\r\ntype Action<T extends FormValues> = (values: T) => Promise<void>\r\n\r\nexport async function formSubmit<T extends FormValues>(\r\n  form: Form<T>,\r\n  event: Event,\r\n  action: Action<T>,\r\n): Promise<void> {\r\n  form.processing = true\r\n\r\n  try {\r\n    assignValuesFromEvent(event, form.values)\r\n    await action(form.values)\r\n  } catch (error) {\r\n    if (error instanceof Error) {\r\n      form.error = error\r\n    } else {\r\n      form.error = new Error(`unknown error`)\r\n      console.error({ message: 'unknown error', error })\r\n    }\r\n  }\r\n\r\n  form.processing = false\r\n}\r\n\r\nfunction assignValuesFromEvent(event: Event, values: FormValues): void {\r\n  const target: any = event.target\r\n\r\n  for (const key of Object.keys(values)) {\r\n    if (target.hasOwnProperty(key)) {\r\n      if (target[key].type === 'checkbox') {\r\n        values[key] = target[key].checked\r\n      } else {\r\n        values[key] = target[key].value\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { reactive } from 'vue'\r\nimport { Form, FormValues } from './Form'\r\n\r\nexport function useForm<T extends FormValues>(values: T): Form<T> {\r\n  return reactive({\r\n    values,\r\n    processing: false,\r\n  }) as Form<T>\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { PlayIcon, QuestionMarkCircleIcon } from '@heroicons/vue/24/outline'\r\nimport { Head } from '@vueuse/head'\r\nimport { useRouter } from 'vue-router'\r\nimport { formSubmit, useForm } from '../../components/form'\r\nimport FormInput from '../../components/form/FormInput.vue'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\n\r\nconst form = useForm({\r\n  url: '',\r\n})\r\n\r\nconst lang = useGlobalLang()\r\n\r\nconst origin = window.location.origin\r\n\r\nconst router = useRouter()\r\n\r\nasync function submit(event: Event) {\r\n  formSubmit(form, event, async ({ url }) => {\r\n    router.push({ path: `/articles/${url}` })\r\n  })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <div class=\"flex h-full max-w-3xl flex-col justify-center\">\r\n      <Head>\r\n        <title v-if=\"lang.isZh()\">文章</title>\r\n        <title v-else>Article</title>\r\n      </Head>\r\n\r\n      <form @submit.prevent=\"submit\">\r\n        <FormInput name=\"url\" type=\"url\" :form=\"form\">\r\n          <template #label>\r\n            <div\r\n              class=\"flex items-end justify-between\"\r\n              title=\"Article | Readonly.Link Manual\"\r\n            >\r\n              <Lang class=\"text-2xl font-bold\">\r\n                <template #zh> 文章 </template>\r\n                <template #en> Article </template>\r\n              </Lang>\r\n              <Hyperlink\r\n                :href=\"\r\n                  lang.isZh()\r\n                    ? `/manuals/${origin}/contents/manual/zh.json/-/kinds-of-contents/article.md`\r\n                    : `/manuals/${origin}/contents/manual/en.json/-/kinds-of-contents/article.md`\r\n                \"\r\n              >\r\n                <QuestionMarkCircleIcon class=\"h-6 w-6\" />\r\n              </Hyperlink>\r\n            </div>\r\n          </template>\r\n\r\n          <template #input-end>\r\n            <button class=\"px-4\">\r\n              <PlayIcon class=\"w-6\" />\r\n            </button>\r\n          </template>\r\n        </FormInput>\r\n      </form>\r\n\r\n      <div class=\"py-16\"></div>\r\n    </div>\r\n  </PageLayout>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Nodes } from '@xieyuheng/x-markdown'\r\nimport { computed } from 'vue'\r\nimport MdNode from '../../MdNode.vue'\r\nimport { State } from '../../State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  node: Nodes.Paragraph\r\n}>()\r\n\r\nconst indent = computed(() => props.state.document.attributes.paragraph?.indent)\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    :style=\"{\r\n      'text-indent': indent && `${indent}rem`,\r\n    }\"\r\n  >\r\n    <MdNode\r\n      v-for=\"(child, index) in node.children\"\r\n      :key=\"index\"\r\n      :state\r\n      :node=\"child\"\r\n    />\r\n  </div>\r\n</template>\r\n","export function slug(text: string): string {\r\n  return text\r\n    .trim()\r\n    .toLowerCase()\r\n    .replace(/[^\\p{Letter}\\-_ 0-9]+/gu, '')\r\n    .replace(/\\s/gu, '-')\r\n    .replace(/_/g, '-')\r\n    .replace(/\\-+/g, '-')\r\n    .replace(/\\-$/g, '')\r\n    .replace(/^\\-/g, '')\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { formatNode, Nodes } from '@xieyuheng/x-markdown'\r\nimport { computed, nextTick, ref, watch } from 'vue'\r\nimport { slug } from '../../../../utils/slug'\r\nimport MdNode from '../../MdNode.vue'\r\nimport { State } from '../../State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  node: Nodes.Headline\r\n}>()\r\n\r\nconst headlineElement = ref<Element | null>(null)\r\n\r\nconst headlineId = computed(() => {\r\n  const text = props.node.children.map(formatNode).join('')\r\n  return slug(text)\r\n})\r\n\r\nconst hovered = ref(false)\r\n\r\nfunction jumpToHeadline() {\r\n  location.hash = '#' + headlineId.value\r\n}\r\n\r\nwatch(\r\n  () => location.hash,\r\n  () => scrollForHash(location.hash),\r\n  { immediate: true },\r\n)\r\n\r\nasync function scrollForHash(hash: string) {\r\n  await nextTick()\r\n  await nextTick()\r\n  await nextTick()\r\n\r\n  const id = hash.slice(1)\r\n  if (id === headlineId.value) {\r\n    scrollIntoView()\r\n  }\r\n}\r\n\r\nfunction scrollIntoView() {\r\n  if (headlineElement.value) {\r\n    headlineElement.value.scrollIntoView({\r\n      behavior: 'smooth',\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <a\r\n    ref=\"headlineElement\"\r\n    :href=\"'#' + headlineId\"\r\n    :id=\"headlineId\"\r\n    class=\"-ml-4 flex items-baseline text-balance\"\r\n    @click.prevent=\"jumpToHeadline()\"\r\n    @mouseover=\"hovered = true\"\r\n    @mouseleave=\"hovered = false\"\r\n    :class=\"{\r\n      'pb-2 pt-4': node.level === 1,\r\n      'pb-2 pt-3': node.level === 2,\r\n      'pb-2 pt-2': node.level === 3 || node.level === 4 || node.level === 5,\r\n      'pb-2 pt-1': node.level === 6,\r\n    }\"\r\n  >\r\n    <div\r\n      class=\"flex w-4 justify-end pr-0.5 font-bold\"\r\n      :class=\"[\r\n        hovered ? 'text-stone-400' : 'text-white dark:text-black',\r\n        {\r\n          'text-3xl sm:text-4xl': node.level === 1,\r\n          'text-2xl sm:text-3xl': node.level === 2,\r\n          'text-xl sm:text-2xl': node.level === 3,\r\n          'text-xl sm:text-xl': node.level === 4,\r\n          'sm:text-xl': node.level === 5 || node.level === 6,\r\n        },\r\n      ]\"\r\n    >\r\n      #\r\n    </div>\r\n\r\n    <div>\r\n      <MdNode\r\n        class=\"inline font-bold\"\r\n        :class=\"{\r\n          'text-3xl sm:text-4xl': node.level === 1,\r\n          'text-2xl sm:text-3xl': node.level === 2,\r\n          'text-xl sm:text-2xl': node.level === 3,\r\n          'text-xl sm:text-xl': node.level === 4,\r\n          'sm:text-xl': node.level === 5 || node.level === 6,\r\n        }\"\r\n        v-for=\"(child, index) in node.children\"\r\n        :key=\"index\"\r\n        :state\r\n        :node=\"child\"\r\n      />\r\n    </div>\r\n  </a>\r\n</template>\r\n","import sanitizeHtml from 'sanitize-html'\r\n\r\n// NOTE https://github.com/apostrophecms/sanitize-html#default-options\r\n\r\nexport function safeHtml(html: string): string {\r\n  return sanitizeHtml(html, {\r\n    allowedTags: [\r\n      'address',\r\n      'article',\r\n      'aside',\r\n      'footer',\r\n      'header',\r\n      'h1',\r\n      'h2',\r\n      'h3',\r\n      'h4',\r\n      'h5',\r\n      'h6',\r\n      'hgroup',\r\n      'main',\r\n      'nav',\r\n      'section',\r\n      'blockquote',\r\n      'dd',\r\n      'div',\r\n      'dl',\r\n      'dt',\r\n      'figcaption',\r\n      'figure',\r\n      'hr',\r\n      'li',\r\n      'main',\r\n      'ol',\r\n      'p',\r\n      'pre',\r\n      'ul',\r\n      'a',\r\n      'abbr',\r\n      'b',\r\n      'bdi',\r\n      'bdo',\r\n      'br',\r\n      'cite',\r\n      'code',\r\n      'data',\r\n      'dfn',\r\n      'em',\r\n      'i',\r\n      'kbd',\r\n      'mark',\r\n      'q',\r\n      'rb',\r\n      'rp',\r\n      'rt',\r\n      'rtc',\r\n      'ruby',\r\n      's',\r\n      'samp',\r\n      'small',\r\n      'span',\r\n      'strong',\r\n      'sub',\r\n      'sup',\r\n      'time',\r\n      'u',\r\n      'var',\r\n      'wbr',\r\n      'caption',\r\n      'col',\r\n      'colgroup',\r\n      'table',\r\n      'tbody',\r\n      'td',\r\n      'tfoot',\r\n      'th',\r\n      'thead',\r\n      'tr',\r\n      'img',\r\n      'svg',\r\n      'path',\r\n      'video',\r\n      'source',\r\n      'iframe',\r\n    ],\r\n    disallowedTagsMode: 'discard',\r\n    allowedAttributes: {\r\n      '*': ['class', 'style', 'width', 'height'],\r\n      a: ['href', 'name', 'target'],\r\n      img: ['src', 'srcset', 'alt', 'title', 'width', 'height', 'loading'],\r\n      source: ['src', 'type'],\r\n      video: ['controls', 'class', 'style', 'width', 'height'],\r\n      iframe: ['src', 'frameborder', 'scrolling'],\r\n      svg: ['xmlns', 'width', 'height', 'viewbox', 'preserveaspectratio'],\r\n      path: ['d'],\r\n    },\r\n    // Lots of these won't come up by default because we don\"t allow them\r\n    selfClosing: ['img', 'br', 'hr'],\r\n    // URL schemes we permit\r\n    allowedSchemes: ['http', 'https', 'ftp', 'mailto', 'tel'],\r\n    allowedSchemesByTag: {},\r\n    allowedSchemesAppliedToAttributes: ['href', 'src', 'cite'],\r\n    allowProtocolRelative: true,\r\n    enforceHtmlBoundary: false,\r\n  })\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Nodes } from '@xieyuheng/x-markdown'\r\nimport { format, isElement, parse, XElement } from '@xieyuheng/x-node'\r\nimport { safeHtml } from '../../../../utils/safeHtml'\r\nimport { Plugin } from '../../Plugin'\r\nimport { State } from '../../State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  node: Nodes.HtmlBlock\r\n}>()\r\n\r\nconst who = 'MdHtmlBlock'\r\n\r\nconst nodes = parse(props.node.text)\r\n\r\nconsole.log({ who, node: props.node, nodes })\r\n\r\nfunction elementPlugin(element: XElement): Plugin | undefined {\r\n  return props.state.plugins.find(\r\n    (plugin) =>\r\n      plugin['@kind'] === 'ElementPlugin' &&\r\n      isElement(element) &&\r\n      plugin.tag === element.tag,\r\n  )\r\n}\r\n</script>\r\n\r\n<template>\r\n  <template v-for=\"(node, index) of nodes\" :key=\"index\">\r\n    <template v-if=\"isElement(node)\">\r\n      <component\r\n        v-if=\"elementPlugin(node)\"\r\n        :is=\"elementPlugin(node)?.component\"\r\n        v-bind=\"elementPlugin(node)?.propsBuilder({ state, element: node })\"\r\n      />\r\n\r\n      <div v-else v-html=\"safeHtml(format([node]))\"></div>\r\n    </template>\r\n\r\n    <div v-else>{{ node }}</div>\r\n  </template>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport hljs from 'highlight.js/lib/common'\r\nimport { computed, onMounted } from 'vue'\r\nimport { useGlobalTheme } from '../../models/theme'\r\nimport { safeHtml } from '../../utils/safeHtml'\r\n\r\nconst props = defineProps<{ text: string }>()\r\n\r\nconst theme = useGlobalTheme()\r\n\r\nconst highlightedHtml = computed(() => {\r\n  const result = hljs.highlightAuto(props.text)\r\n  return result.value\r\n})\r\n\r\nonMounted(async () => {\r\n  if (theme.name === 'dark') {\r\n    await import('highlight.js/styles/github-dark.css')\r\n  } else {\r\n    await import('highlight.js/styles/github.css')\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <pre v-html=\"safeHtml(highlightedHtml)\"></pre>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Nodes } from '@xieyuheng/x-markdown'\r\nimport Highlight from '../../../highlight/Highlight.vue'\r\nimport { State } from '../../State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  node: Nodes.CodeBlock\r\n}>()\r\n\r\nfunction noHighlight() {\r\n  if (!props.node.info) {\r\n    return true\r\n  }\r\n\r\n  if (props.node.info.startsWith('plaintext')) {\r\n    return true\r\n  }\r\n\r\n  return false\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <pre\r\n      v-if=\"noHighlight()\"\r\n      class=\"mx-4 overflow-x-auto font-mono text-base\"\r\n      >{{ node.text }}</pre\r\n    >\r\n\r\n    <Highlight\r\n      v-else\r\n      class=\"mx-4 overflow-x-auto font-mono text-base\"\r\n      :text=\"node.text\"\r\n    />\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Nodes } from '@xieyuheng/x-markdown'\r\nimport { computed, ref, watch } from 'vue'\r\nimport { State } from '../../State'\r\n\r\ndefineProps<{\r\n  state: State\r\n  node: Nodes.SoftLineBreak\r\n}>()\r\n\r\nconst softLineBreakElement = ref<Element | null>(null)\r\nconst needBreak = ref(true)\r\n\r\nconst previousChar = computed(() => {\r\n  const previousElement: any =\r\n    softLineBreakElement.value?.previousElementSibling\r\n  if (previousElement && previousElement.innerText) {\r\n    const text = previousElement.innerText\r\n    return text[text.length - 1]\r\n  }\r\n})\r\n\r\nwatch(\r\n  previousChar,\r\n  () => {\r\n    if (\r\n      previousChar.value &&\r\n      isCJKAndFullwidthPunctuation(previousChar.value)\r\n    ) {\r\n      needBreak.value = false\r\n    }\r\n  },\r\n  { immediate: true },\r\n)\r\n\r\nfunction isCJKAndFullwidthPunctuation(char: string) {\r\n  // NOTE https://en.wikipedia.org/wiki/CJK_Symbols_and_Punctuation\r\n  if (/[\\u3000-\\u303F]/u.test(char)) return true\r\n  // NOTE https://en.wikipedia.org/wiki/Halfwidth_and_Fullwidth_Forms_(Unicode_block)\r\n  if (/[\\uFF00-\\uFFEF]/u.test(char)) return true\r\n  // NOTE https://en.wikipedia.org/wiki/General_Punctuation\r\n  if (/[\\u2000-\\u206F]/u.test(char)) return true\r\n  return false\r\n}\r\n</script>\r\n\r\n<template>\r\n  <br v-if=\"state.document.attributes.newline === 'preserve'\" />\r\n  <span v-else ref=\"softLineBreakElement\">\r\n    <span v-if=\"needBreak\">&nbsp;</span>\r\n  </span>\r\n</template>\r\n","export function isExternalLink(link: string) {\r\n  return (\r\n    link.startsWith('http://') ||\r\n    link.startsWith('https://') ||\r\n    link.startsWith('data:') ||\r\n    link.startsWith('mailto:')\r\n  )\r\n}\r\n","import { isExternalLink } from './isExternalLink'\r\nimport { State } from './State'\r\n\r\nexport function stateResolveLink(state: State, link: string): string {\r\n  if (isExternalLink(link)) {\r\n    return link\r\n  }\r\n\r\n  if (!state.url) {\r\n    return link\r\n  }\r\n\r\n  return new URL(link, state.url).href\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Nodes } from '@xieyuheng/x-markdown'\r\nimport { onMounted } from 'vue'\r\nimport { safeHtml } from '../../../../utils/safeHtml'\r\nimport { State } from '../../State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  node: Nodes.HtmlInline\r\n}>()\r\n\r\nconst who = 'MdHtmlInline'\r\n\r\nonMounted(() => console.log({ who, node: props.node }))\r\n</script>\r\n\r\n<template>\r\n  <div v-html=\"safeHtml(node.text)\"></div>\r\n</template>\r\n","// organize-imports-ignore\r\n\r\nimport Paragraph from './leaf-blocks/MdParagraph.vue'\r\nimport Table from './leaf-blocks/MdTable.vue'\r\nimport Headline from './leaf-blocks/MdHeadline.vue'\r\nimport ThematicBreak from './leaf-blocks/MdThematicBreak.vue'\r\nimport HtmlBlock from './leaf-blocks/MdHtmlBlock.vue'\r\nimport CodeBlock from './leaf-blocks/MdCodeBlock.vue'\r\n\r\nimport BlockQuote from './container-blocks/MdBlockQuote.vue'\r\nimport List from './container-blocks/MdList.vue'\r\nimport Item from './container-blocks/MdItem.vue'\r\nimport OrderedList from './container-blocks/MdOrderedList.vue'\r\nimport OrderedItem from './container-blocks/MdOrderedItem.vue'\r\n\r\nimport Emphasis from './inlines/MdEmphasis.vue'\r\nimport Strong from './inlines/MdStrong.vue'\r\nimport HardLineBreak from './inlines/MdHardLineBreak.vue'\r\nimport SoftLineBreak from './inlines/MdSoftLineBreak.vue'\r\nimport Link from './inlines/MdLink.vue'\r\nimport FootnoteRef from './inlines/MdFootnoteRef.vue'\r\nimport Image from './inlines/MdImage.vue'\r\nimport Code from './inlines/MdCode.vue'\r\nimport HtmlInline from './inlines/MdHtmlInline.vue'\r\nimport Text from './inlines/MdText.vue'\r\nimport { Component } from 'vue'\r\n\r\nexport const components: Record<string, Component> = {\r\n  Paragraph,\r\n  Table,\r\n  Headline,\r\n  ThematicBreak,\r\n  HtmlBlock,\r\n  CodeBlock,\r\n\r\n  BlockQuote,\r\n  List,\r\n  Item,\r\n  OrderedList,\r\n  OrderedItem,\r\n\r\n  Emphasis,\r\n  Strong,\r\n  HardLineBreak,\r\n  SoftLineBreak,\r\n  Link,\r\n  FootnoteRef,\r\n  Image,\r\n  Code,\r\n  HtmlInline,\r\n  Text,\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Node } from '@xieyuheng/x-markdown'\r\nimport { computed } from 'vue'\r\nimport { State } from './State'\r\nimport { components } from './nodes'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  node: Node\r\n}>()\r\n\r\nconst component = computed(() => components[props.node.kind])\r\n</script>\r\n\r\n<template>\r\n  <component v-if=\"component\" :is=\"component\" :state :node=\"node\" />\r\n  <span\r\n    v-else\r\n    class=\"border-2 border-rose-400 font-bold text-rose-400\"\r\n    title=\"Unhandled Markdown Node\"\r\n    >{{ node.kind }}</span\r\n  >\r\n</template>\r\n","export function leftPad(\r\n  line: string,\r\n  size: number,\r\n  char: string = ' ',\r\n): string {\r\n  return char.repeat(size - line.length) + line\r\n}\r\n","import { leftPad } from './leftPad'\r\n\r\nexport function formatDate(t: Date | number | string): string {\r\n  if (typeof t === 'string') t = new Date(t)\r\n  if (typeof t === 'number') t = new Date(t)\r\n\r\n  const YYYY = t.getFullYear()\r\n  const MM = leftPad((t.getMonth() + 1).toString(), 2, '0')\r\n  const DD = leftPad(t.getDate().toString(), 2, '0')\r\n\r\n  return `${YYYY}-${MM}-${DD}`\r\n}\r\n\r\nexport function formatTime(\r\n  t: Date | number | string,\r\n  opts?: { withMilliseconds?: boolean },\r\n): string {\r\n  if (typeof t === 'string') t = new Date(t)\r\n  if (typeof t === 'number') t = new Date(t)\r\n\r\n  const hh = leftPad(t.getHours().toString(), 2, '0')\r\n  const mm = leftPad(t.getMinutes().toString(), 2, '0')\r\n  const ss = leftPad(t.getSeconds().toString(), 2, '0')\r\n\r\n  const mi = leftPad((t.getTime() % 1000).toString(), 3, '0')\r\n\r\n  if (opts?.withMilliseconds) {\r\n    return `${hh}:${mm}:${ss}.${mi}`\r\n  } else {\r\n    return `${hh}:${mm}:${ss}`\r\n  }\r\n}\r\n\r\nexport function formatDateTime(\r\n  t: Date | number,\r\n  opts?: { withMilliseconds?: boolean },\r\n): string {\r\n  if (typeof t === 'number') t = new Date(t)\r\n\r\n  const date = formatDate(t)\r\n  const time = formatTime(t, opts)\r\n\r\n  return `${date} ${time}`\r\n}\r\n\r\nexport function formatAgo(\r\n  t: Date | number | string,\r\n  options: { lang: string },\r\n): string {\r\n  if (typeof t === 'string') t = new Date(t)\r\n  if (typeof t === 'number') t = new Date(t)\r\n\r\n  const detla = Date.now() - t.getTime()\r\n\r\n  const A_MONTH = 30 * 24 * 60 * 60 * 1000\r\n\r\n  if (detla > A_MONTH) {\r\n    return formatDate(t)\r\n  }\r\n\r\n  return formatDetla(detla, options)\r\n}\r\n\r\nexport function formatDetla(t: number, options: { lang: string }): string {\r\n  const { lang } = options\r\n\r\n  const s = Math.floor(t / 1000)\r\n  const m = Math.floor(s / 60)\r\n  const h = Math.floor(m / 60)\r\n  const d = Math.floor(h / 24)\r\n\r\n  if (d) return lang.startsWith('zh') ? `${d} 天前` : `${d} days ago`\r\n  if (h) return lang.startsWith('zh') ? `${h} 小时前` : `${h} hours ago`\r\n  if (m) return lang.startsWith('zh') ? `${m} 分钟前` : `${m} minutes ago`\r\n  else return lang.startsWith('zh') ? `刚才` : `just now`\r\n}\r\n","import { formatDate } from '../../utils/formatDate'\r\n\r\nexport type Attributes = {\r\n  title?: string\r\n  subtitle?: string\r\n  translators: Array<string>\r\n  authors: Array<string>\r\n  keywords: Array<string>\r\n  venue?: string\r\n  date?: string\r\n}\r\n\r\nexport function normalizeAttributes(attributes: any): Attributes {\r\n  let title = undefined\r\n  if (typeof attributes.title === 'string') title = attributes.title\r\n\r\n  let subtitle = undefined\r\n  if (typeof attributes.subtitle === 'string') title = attributes.subtitle\r\n\r\n  const translators = []\r\n  if (attributes.translator) translators.push(attributes.translator)\r\n  if (attributes.translators) translators.push(...attributes.translators)\r\n\r\n  const authors = []\r\n  if (attributes.author) authors.push(attributes.author)\r\n  if (attributes.authors) authors.push(...attributes.authors)\r\n\r\n  const keywords = []\r\n  if (attributes.keywords) keywords.push(...attributes.keywords)\r\n  if (attributes.tags) keywords.push(...attributes.tags)\r\n\r\n  let venue = attributes.venue\r\n\r\n  let date = undefined\r\n  if (attributes.year) date = attributes.year\r\n  if (attributes.date) date = normalizeDate(attributes.date)\r\n\r\n  return {\r\n    title,\r\n    subtitle,\r\n    translators,\r\n    authors,\r\n    keywords,\r\n    venue,\r\n    date,\r\n  }\r\n}\r\n\r\nexport function normalizeDate(date: any): string | undefined {\r\n  if (typeof date === 'number') {\r\n    if (date < 10000) return date.toString()\r\n    else return formatDate(date)\r\n  } else if (date instanceof Date) {\r\n    return formatDate(date)\r\n  } else if (typeof date === 'string') {\r\n    const parsed = new Date(date)\r\n    if (Number.isNaN(parsed.getTime())) return date\r\n    else return formatDate(parsed)\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport {\r\n  CalendarDaysIcon,\r\n  HashtagIcon,\r\n  LanguageIcon,\r\n  MapPinIcon,\r\n  PencilIcon,\r\n} from '@heroicons/vue/24/outline'\r\nimport { computed } from 'vue'\r\nimport { State } from '../../State'\r\nimport { normalizeAttributes } from '../../normalizeAttributes'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst attributes = computed(() =>\r\n  normalizeAttributes(props.state.document.attributes),\r\n)\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-col text-black dark:text-white\">\r\n    <div\r\n      class=\"flex items-center space-x-2\"\r\n      v-if=\"attributes.authors.length > 0\"\r\n    >\r\n      <PencilIcon class=\"w-4 shrink-0\" />\r\n      <span class=\"font-bold\">{{ attributes.authors.join(', ') }}</span>\r\n    </div>\r\n\r\n    <div\r\n      class=\"flex items-center space-x-2\"\r\n      v-if=\"attributes.translators.length > 0\"\r\n    >\r\n      <LanguageIcon class=\"w-4 shrink-0\" />\r\n      <span>{{ attributes.translators.join(', ') }}</span>\r\n    </div>\r\n\r\n    <div class=\"flex items-center space-x-2\" v-if=\"attributes.date\">\r\n      <CalendarDaysIcon class=\"w-4 shrink-0\" />\r\n      <span>{{ attributes.date }}</span>\r\n    </div>\r\n\r\n    <div class=\"flex items-center space-x-2\" v-if=\"attributes.venue\">\r\n      <MapPinIcon class=\"w-4 shrink-0\" />\r\n      <span> {{ attributes.venue }}</span>\r\n    </div>\r\n\r\n    <div\r\n      class=\"flex items-center space-x-2\"\r\n      v-if=\"attributes.keywords.length > 0\"\r\n    >\r\n      <HashtagIcon class=\"w-4 shrink-0\" />\r\n      <span>{{ attributes.keywords.join(', ') }}</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { computed } from 'vue'\r\nimport { State } from '../../State'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst title = computed(() => props.state.document.attributes.title)\r\nconst subtitle = computed(() => props.state.document.attributes.subtitle)\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-col\">\r\n    <h1\r\n      class=\"text-balance text-4xl font-bold leading-tight sm:text-5xl sm:leading-tight\"\r\n    >\r\n      {{ title }}\r\n    </h1>\r\n\r\n    <h1\r\n      v-if=\"subtitle\"\r\n      class=\"text-balance py-1 text-2xl leading-tight sm:text-3xl sm:leading-tight\"\r\n    >\r\n      {{ subtitle }}\r\n    </h1>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport MdNode from '../../MdNode.vue'\r\nimport { State } from '../../State'\r\nimport MdDefaultAttributes from './MdDefaultAttributes.vue'\r\nimport MdDefaultFootnotes from './MdDefaultFootnotes.vue'\r\nimport MdDefaultTitle from './MdDefaultTitle.vue'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst names = [\r\n  'venue',\r\n  'author',\r\n  'authors',\r\n  'translator',\r\n  'translators',\r\n  'keywords',\r\n  'year',\r\n  'date',\r\n]\r\n\r\nfunction showAttributes() {\r\n  const keys = Object.keys(props.state.document.attributes)\r\n  return names.some((name) => keys.includes(name))\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-col text-xl\">\r\n    <MdDefaultTitle\r\n      class=\"my-4\"\r\n      v-if=\"state.document.attributes.title\"\r\n      :state\r\n    />\r\n\r\n    <MdDefaultAttributes v-if=\"showAttributes()\" class=\"mb-4\" :state />\r\n\r\n    <div\r\n      class=\"my-2\"\r\n      v-for=\"(child, index) in state.document.children\"\r\n      :key=\"index\"\r\n    >\r\n      <MdNode :state :node=\"child\" />\r\n    </div>\r\n\r\n    <div\r\n      v-if=\"state.document.footnotes.length > 0\"\r\n      class=\"ml-3 mt-6 border-t-2 border-black pt-4 dark:border-white\"\r\n    >\r\n      <MdDefaultFootnotes :state />\r\n    </div>\r\n  </div>\r\n</template>\r\n","import { Component } from 'vue'\r\nimport Activity from './activity/MdActivity.vue'\r\nimport Dedication from './dedication/MdDedication.vue'\r\nimport Default from './default/MdDefault.vue'\r\n\r\nexport const components: Record<string, Component> = {\r\n  Default,\r\n  Dedication,\r\n  Activity,\r\n}\r\n","import { XElement } from '@xieyuheng/x-node'\r\nimport { Component } from 'vue'\r\nimport { State } from './State'\r\n\r\nexport type Plugin = ElementPlugin\r\n\r\nexport type PropsBuilder = (ctx: {\r\n  state: State\r\n  element: XElement\r\n}) => Record<string, any>\r\n\r\nexport type ElementPlugin = {\r\n  '@kind': 'ElementPlugin'\r\n  tag: string\r\n  component: Component\r\n  propsBuilder: PropsBuilder\r\n}\r\n\r\nexport function ElementPlugin(\r\n  tag: string,\r\n  component: Component,\r\n  propsBuilder: PropsBuilder,\r\n): ElementPlugin {\r\n  return {\r\n    '@kind': 'ElementPlugin',\r\n    tag,\r\n    component,\r\n    propsBuilder,\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport 'mimor'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport { useGlobalTheme } from '../../models/theme'\r\n\r\ndefineProps<{ src: string }>()\r\n\r\nconst lang = useGlobalLang()\r\nconst theme = useGlobalTheme()\r\n</script>\r\n\r\n<template>\r\n  <div class=\"h-[36rem] w-full sm:w-[36rem]\" title=\"An embedded mimor.\">\r\n    <x-mimor\r\n      class=\"h-full\"\r\n      :src=\"src\"\r\n      :lang-tag=\"lang.tag\"\r\n      :theme-name=\"theme.name\"\r\n    />\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport {\r\n  CalendarDaysIcon,\r\n  HashtagIcon,\r\n  LanguageIcon,\r\n  MapPinIcon,\r\n  PencilIcon,\r\n} from '@heroicons/vue/24/outline'\r\nimport { computed } from 'vue'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { normalizeAttributes } from '../../components/md/normalizeAttributes'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { ArticleConfig } from './Config'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  config: ArticleConfig\r\n}>()\r\n\r\nconst attributes = computed(() => normalizeAttributes(props.config.attributes))\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <Lang class=\"text-base text-stone-500 dark:text-stone-400\">\r\n      <template #zh> 文章 </template>\r\n      <template #en> Article </template>\r\n    </Lang>\r\n\r\n    <Hyperlink :href=\"`/articles/${state.url}`\">\r\n      <div class=\"py-1 hover:text-stone-500 hover:dark:text-stone-400\">\r\n        <div class=\"text-balance font-bold\">\r\n          {{ config.title }}\r\n        </div>\r\n        <div\r\n          v-if=\"config.attributes.subtitle\"\r\n          class=\"text-balance text-base font-bold\"\r\n        >\r\n          {{ config.attributes.subtitle }}\r\n        </div>\r\n      </div>\r\n    </Hyperlink>\r\n\r\n    <div class=\"flex flex-col text-base text-black dark:text-white\">\r\n      <div\r\n        class=\"flex items-center space-x-2\"\r\n        v-if=\"attributes.authors.length > 0\"\r\n      >\r\n        <PencilIcon class=\"w-4 shrink-0\" />\r\n        <span class=\"font-bold\">{{ attributes.authors.join(', ') }}</span>\r\n      </div>\r\n\r\n      <div\r\n        class=\"flex items-center space-x-2\"\r\n        v-if=\"attributes.translators.length > 0\"\r\n      >\r\n        <LanguageIcon class=\"w-4 shrink-0\" />\r\n        <span>{{ attributes.translators.join(', ') }}</span>\r\n      </div>\r\n\r\n      <div class=\"flex items-center space-x-2\" v-if=\"attributes.date\">\r\n        <CalendarDaysIcon class=\"w-4 shrink-0\" />\r\n        <span>{{ attributes.date }}</span>\r\n      </div>\r\n\r\n      <div class=\"flex items-center space-x-2\" v-if=\"attributes.venue\">\r\n        <MapPinIcon class=\"w-4 shrink-0\" />\r\n        <span>{{ attributes.venue }}</span>\r\n      </div>\r\n\r\n      <div\r\n        class=\"flex items-center space-x-2\"\r\n        v-if=\"attributes.keywords.length > 0\"\r\n      >\r\n        <HashtagIcon class=\"w-4 shrink-0\" />\r\n        <span>{{ attributes.keywords.join(', ') }}</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n","import { join } from 'path-browserify'\r\nimport { useGlobalTheme } from '../theme'\r\nimport { Author } from './Author'\r\n\r\nexport function authorAvatarURL(author: Author): URL {\r\n  const theme = useGlobalTheme()\r\n\r\n  if (typeof author.config.avatar === 'string') {\r\n    return new URL(\r\n      join(author.config.src || '', author.config.avatar),\r\n      author.url,\r\n    )\r\n  }\r\n\r\n  if (theme.name === 'dark') {\r\n    return new URL(\r\n      join(author.config.src || '', author.config.avatar.dark),\r\n      author.url,\r\n    )\r\n  } else {\r\n    return new URL(\r\n      join(author.config.src || '', author.config.avatar.light),\r\n      author.url,\r\n    )\r\n  }\r\n}\r\n","import { z, ZodType } from 'zod'\r\n\r\nexport type AuthorContact = {\r\n  bilibili?: string\r\n  github?: string\r\n  email?: string\r\n  twitter?: string\r\n  mimor?: string\r\n}\r\n\r\nexport const AuthorContactSchema: ZodType<AuthorContact> = z.object({\r\n  bilibili: z.optional(z.string()),\r\n  github: z.optional(z.string()),\r\n  email: z.optional(z.string()),\r\n  twitter: z.optional(z.string()),\r\n  mimor: z.optional(z.string()),\r\n})\r\n","import { z, ZodType } from 'zod'\r\nimport { AuthorContact, AuthorContactSchema } from './AuthorContact'\r\n\r\nexport type AuthorConfig = {\r\n  kind: 'Author'\r\n  name: string\r\n  tagline?: string\r\n  avatar: string | { light: string; dark: string }\r\n  homepage: string\r\n  src?: string\r\n  activities: Array<string>\r\n  tabs?: Record<string, string>\r\n  contact?: AuthorContact\r\n}\r\n\r\nexport const AuthorConfigSchema: ZodType<AuthorConfig> = z.object({\r\n  kind: z.literal('Author'),\r\n  name: z.string(),\r\n  tagline: z.optional(z.string()),\r\n  avatar: z.union([\r\n    z.string(),\r\n    z.object({\r\n      light: z.string(),\r\n      dark: z.string(),\r\n    }),\r\n  ]),\r\n  homepage: z.string(),\r\n  src: z.optional(z.string()),\r\n  activities: z.array(z.string()),\r\n  tabs: z.optional(z.record(z.string(), z.string())),\r\n  contact: z.optional(AuthorContactSchema),\r\n})\r\n","import {\r\n  AuthorConfig,\r\n  AuthorConfigSchema,\r\n} from '../../models/author/AuthorConfig'\r\n\r\nexport async function loadAuthorConfig(\r\n  url: string | URL,\r\n): Promise<AuthorConfig> {\r\n  const response = await fetch(url)\r\n  const json = await response.json()\r\n  return AuthorConfigSchema.parse(json)\r\n}\r\n","import { Author } from '../../models/author/Author'\r\nimport { loadAuthorConfig } from './loadAuthorConfig'\r\n\r\nexport async function loadAuthor(url: string): Promise<Author> {\r\n  return { url, config: await loadAuthorConfig(url) }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { computed } from 'vue'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { authorAvatarURL } from '../../models/author'\r\nimport { AuthorConfig } from '../../models/author/AuthorConfig'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  config: AuthorConfig\r\n}>()\r\n\r\nconst avatarURL = computed(() =>\r\n  authorAvatarURL({\r\n    url: props.state.url,\r\n    config: props.config,\r\n  }),\r\n)\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <Lang class=\"text-base text-stone-500 dark:text-stone-400\">\r\n      <template #zh> 作者 </template>\r\n      <template #en> Author </template>\r\n    </Lang>\r\n\r\n    <div class=\"flex items-center space-x-2 pt-1\">\r\n      <Hyperlink\r\n        :href=\"`/authors/${state.url}`\"\r\n        class=\"shrink-0 object-contain\"\r\n      >\r\n        <img\r\n          :alt=\"config.name\"\r\n          :src=\"avatarURL.href\"\r\n          class=\"h-[5rem] w-[5rem]\"\r\n        />\r\n      </Hyperlink>\r\n\r\n      <div class=\"overflow-x-auto\">\r\n        <Hyperlink :href=\"`/authors/${state.url}`\">\r\n          <div\r\n            class=\"overflow-x-auto overflow-y-hidden whitespace-pre py-1 font-bold hover:text-stone-500 hover:dark:text-stone-400\"\r\n          >\r\n            {{ config.name }}\r\n          </div>\r\n        </Hyperlink>\r\n\r\n        <Hyperlink v-if=\"state.url\" :href=\"`/authors/${state.url}`\">\r\n          <div\r\n            class=\"overflow-x-auto overflow-y-hidden whitespace-pre py-0.5 font-mono text-xs hover:underline\"\r\n          >\r\n            {{ state.url }}\r\n          </div>\r\n        </Hyperlink>\r\n\r\n        <div\r\n          v-if=\"config.tagline\"\r\n          class=\"overflow-x-auto overflow-y-hidden whitespace-pre text-base\"\r\n        >\r\n          {{ config.tagline }}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n","import { Document, Nodes, formatNode } from '@xieyuheng/x-markdown'\r\n\r\nexport function documentTitle(document: Document): string | undefined {\r\n  if (document.attributes.title) {\r\n    return document.attributes.title\r\n  }\r\n\r\n  const firstHeadline = documentFirstHeadline(document)\r\n  if (firstHeadline !== undefined) {\r\n    return formatNode(firstHeadline)\r\n  }\r\n\r\n  return undefined\r\n}\r\n\r\nfunction documentFirstHeadline(document: Document): Nodes.Headline | undefined {\r\n  return document.children.find((node) => node.kind === 'Headline') as\r\n    | Nodes.Headline\r\n    | undefined\r\n}\r\n","import { parseDocument } from '@xieyuheng/x-markdown'\r\nimport { documentTitle } from '../../components/md/documentTitle'\r\nimport { Config } from './Config'\r\n\r\nexport async function loadConfig(url: string): Promise<Config> {\r\n  if (url.endsWith('.md')) {\r\n    const response = await fetch(url)\r\n    const text = await response.text()\r\n    const document = parseDocument(text)\r\n\r\n    return {\r\n      kind: 'Article',\r\n      title: documentTitle(document) || url,\r\n      attributes: document.attributes,\r\n    }\r\n  }\r\n\r\n  const response = await fetch(url)\r\n  const json = await response.json()\r\n  return json\r\n}\r\n","import * as Kv from 'idb-keyval'\r\nimport { State } from './State'\r\nimport { loadConfig } from './loadConfig'\r\n\r\nexport async function stateRefresh(state: State): Promise<void> {\r\n  const config = await loadConfig(state.url)\r\n  state.config = config\r\n  const store = Kv.createStore('readonly.link/<readonlylink>', 'configs')\r\n  await Kv.set(state.url, config, store)\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { onMounted } from 'vue'\r\nimport ReadonlylinkArticle from './ReadonlylinkArticle.vue'\r\nimport ReadonlylinkAuthor from './ReadonlylinkAuthor.vue'\r\nimport ReadonlylinkBook from './ReadonlylinkBook.vue'\r\nimport ReadonlylinkManual from './ReadonlylinkManual.vue'\r\nimport ReadonlylinkUnknown from './ReadonlylinkUnknown.vue'\r\nimport { State } from './State'\r\nimport { stateRefresh } from './stateRefresh'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nonMounted(async () => {\r\n  if (props.state.isLoadedFromCache) {\r\n    await stateRefresh(props.state)\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <!-- prettier-ignore -->\r\n  <div>\r\n    <ReadonlylinkArticle v-if=\"state.config.kind === 'Article'\" :state :config=\"state.config\" />\r\n    <ReadonlylinkBook v-else-if=\"state.config.kind === 'Book'\" :state :config=\"state.config\" />\r\n    <ReadonlylinkManual v-else-if=\"state.config.kind === 'Manual'\" :state :config=\"state.config\" />\r\n    <ReadonlylinkAuthor v-else-if=\"state.config.kind === 'Author'\" :state :config=\"state.config\" />\r\n    <ReadonlylinkUnknown v-else :state :config=\"state.config\" />\r\n  </div>\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { State } from './State'\r\nimport { loadConfig } from './loadConfig'\r\n\r\nexport type StateOptions = {\r\n  url: string\r\n}\r\n\r\nexport async function stateLoad(options: StateOptions): Promise<State> {\r\n  const { url } = options\r\n\r\n  const store = Kv.createStore('readonly.link/<readonlylink>', 'configs')\r\n  const cachedConfig = await Kv.get(url, store)\r\n  if (cachedConfig) {\r\n    return {\r\n      url,\r\n      config: cachedConfig,\r\n      isLoadedFromCache: true,\r\n    }\r\n  } else {\r\n    const config = await loadConfig(url)\r\n    await Kv.set(url, config, store)\r\n    return {\r\n      url,\r\n      config,\r\n      isLoadedFromCache: false,\r\n    }\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { reactive, ref, watchEffect } from 'vue'\r\nimport ReadonlylinkLoaded from './ReadonlylinkLoaded.vue'\r\nimport ReadonlylinkLoading from './ReadonlylinkLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nconst props = defineProps<{\r\n  url: string\r\n}>()\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nwatchEffect(async () => {\r\n  state.value = reactive(await stateLoad(props))\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"mb-1.5 border border-black px-3 py-2.5 sm:max-w-[40rem] dark:border-white\"\r\n  >\r\n    <ReadonlylinkLoaded v-if=\"state\" :state />\r\n    <ReadonlylinkLoading v-else :options=\"props\" />\r\n  </div>\r\n</template>\r\n","import { markRaw } from 'vue'\r\nimport * as Plugins from '../components/md/Plugin'\r\nimport { stateResolveLink } from '../components/md/stateResolveLink'\r\nimport Mimor from './mimor/Mimor.vue'\r\nimport Readonlylink from './readonlylink/Readonlylink.vue'\r\n\r\nexport const plugins = [\r\n  Plugins.ElementPlugin('readonlylink', markRaw(Readonlylink), (ctx) => ({\r\n    url: stateResolveLink(ctx.state, ctx.element.attributes.href),\r\n  })),\r\n\r\n  Plugins.ElementPlugin('mimor', markRaw(Mimor), (ctx) => ({\r\n    src: stateResolveLink(ctx.state, ctx.element.attributes.src),\r\n  })),\r\n]\r\n","import { Document } from '@xieyuheng/x-markdown'\r\nimport { plugins } from '../../md-plugins'\r\nimport { State } from './State'\r\n\r\nexport type StateOptions = {\r\n  url?: URL\r\n  document: Document\r\n}\r\n\r\nexport function stateCreate(options: StateOptions): State {\r\n  const { url, document } = options\r\n\r\n  return {\r\n    url,\r\n    document,\r\n    plugins,\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Document } from '@xieyuheng/x-markdown'\r\nimport { computed, reactive, ref, watchEffect } from 'vue'\r\nimport { State } from './State'\r\nimport { components } from './pages'\r\nimport { stateCreate } from './stateCreate'\r\n\r\nconst props = defineProps<{\r\n  url?: URL\r\n  document: Document\r\n}>()\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nwatchEffect(() => {\r\n  if (!state.value) {\r\n    state.value = reactive(\r\n      stateCreate({ url: props.url, document: props.document }),\r\n    )\r\n  } else {\r\n    Object.assign(\r\n      state.value,\r\n      stateCreate({ url: props.url, document: props.document }),\r\n    )\r\n  }\r\n})\r\n\r\nconst kind = computed(() => state.value?.document.attributes.kind || 'Default')\r\nconst component = computed(() => components[kind.value])\r\n</script>\r\n\r\n<template>\r\n  <component :is=\"component\" :state />\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { computed, watch } from 'vue'\r\nimport MdPage from '../../components/md/MdPage.vue'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nwatch(\r\n  () => props.state.url,\r\n  () => {\r\n    window.scrollTo(0, 0)\r\n  },\r\n)\r\n\r\nconst url = computed(() => new URL(props.state.url))\r\n</script>\r\n\r\n<template>\r\n  <MdPage class=\"m-6\" :document=\"state.document\" :url=\"url\" />\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { watch } from 'vue'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nwatch(\r\n  () => props.state.url,\r\n  () => {\r\n    window.scrollTo(0, 0)\r\n  },\r\n)\r\n</script>\r\n\r\n<template>\r\n  <div class=\"m-6 overflow-x-auto whitespace-pre font-mono\">\r\n    {{ state.text }}\r\n  </div>\r\n</template>\r\n","import { State } from './State'\r\n\r\nexport function stateIsMarkdown(state: State): boolean {\r\n  return state.url.endsWith('.md') || state.contentType === 'text/markdown'\r\n}\r\n","import * as Kv from 'idb-keyval'\r\nimport { reactive, watch } from 'vue'\r\nimport { History, HistoryEntry } from './History'\r\n\r\nconst globalHistory: History = reactive({\r\n  record: {},\r\n})\r\n\r\nlet initialized = false\r\n\r\nexport async function useHistory(): Promise<History> {\r\n  if (initialized) {\r\n    return globalHistory\r\n  }\r\n\r\n  const record = await Kv.get('readonly.link/globalHistory.record')\r\n  if (record) {\r\n    globalHistory.record = record\r\n  }\r\n  //  globalHistory.record =  {}\r\n\r\n  initialized = true\r\n\r\n  return globalHistory\r\n}\r\n\r\nwatch(\r\n  () => globalHistory.record,\r\n  async (value) => {\r\n    const record: Record<string, HistoryEntry> = {}\r\n    for (const [key, value] of Object.entries(globalHistory.record)) {\r\n      record[key] = { ...value }\r\n    }\r\n\r\n    await Kv.set('readonly.link/globalHistory.record', record)\r\n  },\r\n  {\r\n    deep: true,\r\n  },\r\n)\r\n\r\nexport function sortGlobalHistoryRecord(): void {\r\n  const entries = Object.entries(globalHistory.record)\r\n\r\n  entries.sort(([, x], [, y]) => (x.time > y.time ? -1 : 1))\r\n\r\n  for (const [key, value] of entries) {\r\n    delete globalHistory.record[key]\r\n    globalHistory.record[key] = value\r\n  }\r\n}\r\n","export function stringTrimEnd(input: string, pattern: string): string {\r\n  if (input.endsWith(pattern)) {\r\n    const prefix = input.slice(0, input.length - pattern.length)\r\n    return stringTrimEnd(prefix, pattern)\r\n  }\r\n\r\n  return input\r\n}\r\n","import { parseDocument } from '@xieyuheng/x-markdown'\r\nimport { useHistory } from '../../models/history/useHistory'\r\nimport { stringTrimEnd } from '../../utils/stringTrimEnd'\r\nimport { State } from './State'\r\n\r\nexport type StateOptions = {\r\n  url: string\r\n}\r\n\r\nexport async function stateLoad(options: StateOptions): Promise<State> {\r\n  const url = stringTrimEnd(options.url, '/')\r\n  const response = await fetch(url)\r\n  const contentType = response.headers.get('content-type') || ''\r\n  const text = await response.text()\r\n  const document = parseDocument(text)\r\n\r\n  const history = await useHistory()\r\n  history.record[url] = { time: Date.now(), url }\r\n\r\n  return {\r\n    url,\r\n    text,\r\n    contentType,\r\n    document,\r\n  }\r\n}\r\n","import * as Kv from 'idb-keyval'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nexport async function stateRefresh(state: State): Promise<void> {\r\n  const store = Kv.createStore('readonly.link/articles', 'cache')\r\n  const newState = await stateLoad(state)\r\n  Object.assign(state, newState)\r\n  await Kv.set(state.url, newState, store)\r\n}\r\n","import { documentTitle } from '../../components/md/documentTitle'\r\nimport { State } from './State'\r\n\r\nexport function stateTitle(state: State): string {\r\n  return documentTitle(state.document) || state.url\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Head } from '@vueuse/head'\r\nimport { onMounted } from 'vue'\r\nimport ArticleMarkdown from './ArticleMarkdown.vue'\r\nimport ArticlePlaintext from './ArticlePlaintext.vue'\r\nimport { State } from './State'\r\nimport { stateIsMarkdown } from './stateIsMarkdown'\r\nimport { stateRefresh } from './stateRefresh'\r\nimport { stateTitle } from './stateTitle'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nonMounted(async () => {\r\n  if (props.state.isLoadedFromCache) {\r\n    await stateRefresh(props.state)\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"overflow-auto bg-white text-black dark:bg-black dark:text-white\">\r\n    <Head>\r\n      <title>{{ stateTitle(state) }}</title>\r\n    </Head>\r\n\r\n    <div class=\"mx-auto max-w-3xl\">\r\n      <ArticleMarkdown v-if=\"stateIsMarkdown(state)\" :state />\r\n      <ArticlePlaintext v-else :state />\r\n    </div>\r\n  </div>\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { stringTrimEnd } from '../../utils/stringTrimEnd'\r\nimport { State } from './State'\r\nimport { StateOptions, stateLoad } from './stateLoad'\r\n\r\nexport async function stateLoadFromCacheFirst(\r\n  options: StateOptions,\r\n): Promise<State> {\r\n  const url = stringTrimEnd(options.url, '/')\r\n  console.log(url);\r\n  const store = Kv.createStore('readonly.link/articles', 'cache')\r\n  const cached = await Kv.get(url, store)\r\n  if (cached) {\r\n    return {\r\n      ...cached,\r\n      url,\r\n      isLoadedFromCache: true,\r\n    }\r\n  } else {\r\n    const state = await stateLoad(options)\r\n    await Kv.set(url, state, store)\r\n    return state\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { reactive, ref, watchEffect } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport ArticleLoaded from './ArticleLoaded.vue'\r\nimport ArticleLoading from './ArticleLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoadFromCacheFirst } from './stateLoadFromCacheFirst'\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nconst route = useRoute()\r\n\r\nwatchEffect(async () => {\r\n  state.value = reactive(\r\n    await stateLoadFromCacheFirst({\r\n      url: String(route.params.url),\r\n    }),\r\n  )\r\n})\r\n</script>\r\n\r\n<template>\r\n  <ArticleLoaded v-if=\"state\" :state :key=\"state.url\" />\r\n  <ArticleLoading\r\n    v-else\r\n    :options=\"{\r\n      url: String(route.params.url),\r\n    }\"\r\n  />\r\n</template>\r\n","export function useDefaultAuthorList(): Array<string> {\r\n  return [\r\n    'https://readonly.link/contents/author.json',\r\n    'https://inner.xieyuheng.com/author.json',\r\n    'https://shadowrz.github.io/author.json',\r\n    'https://code-of-cicada.fidb.app/docs/author.json',\r\n    'https://code-of-fidb.fidb.app/docs/author.json',\r\n    'https://mimor.app/contents/author.json',\r\n  ]\r\n}\r\n","export async function promiseAllFulfilled<T>(\r\n  promises: Array<Promise<T>>,\r\n): Promise<Array<T>> {\r\n  const results = await Promise.allSettled(promises)\r\n\r\n  const values: Array<T> = []\r\n  for (const result of results) {\r\n    if (result.status === 'fulfilled') {\r\n      values.push(result.value)\r\n    }\r\n  }\r\n\r\n  return values\r\n}\r\n","import * as Kv from 'idb-keyval'\r\nimport { loadAuthor } from '../../models/author'\r\nimport { useDefaultAuthorList } from '../../models/author-list'\r\nimport { promiseAllFulfilled } from '../../utils/promiseAllFulfilled'\r\nimport { State } from './State'\r\n\r\nexport async function stateRefresh(state: State): Promise<void> {\r\n  const list = useDefaultAuthorList()\r\n  const authors = await promiseAllFulfilled(list.map(loadAuthor))\r\n  state.authors = authors\r\n  await Kv.set('readonly.link/AuthorList/state.authors', authors)\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Head } from '@vueuse/head'\r\nimport { onMounted } from 'vue'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport AuthorCard from './AuthorCard.vue'\r\nimport { State } from './State'\r\nimport { stateRefresh } from './stateRefresh'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst lang = useGlobalLang()\r\n\r\nonMounted(async () => {\r\n  if (props.state.isLoadedFromCache) {\r\n    await stateRefresh(props.state)\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <Head>\r\n      <title v-if=\"lang.isZh()\">作者 | 只读</title>\r\n      <title v-else>Authors | Readonly</title>\r\n    </Head>\r\n\r\n    <div class=\"flex items-baseline\">\r\n      <Lang class=\"text-2xl font-bold\">\r\n        <template #zh> 作者 </template>\r\n        <template #en> Authors </template>\r\n      </Lang>\r\n    </div>\r\n\r\n    <div class=\"flex flex-col space-y-3 py-2\">\r\n      <AuthorCard\r\n        v-for=\"(author, index) of state.authors\"\r\n        :key=\"index\"\r\n        :author=\"author\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { useDefaultAuthorList } from '../../models/author-list'\r\nimport { State } from './State'\r\nimport { stateRefresh } from './stateRefresh'\r\n\r\nexport async function stateLoad(): Promise<State> {\r\n  const list = useDefaultAuthorList()\r\n  const state: State = {\r\n    list,\r\n    authors: [],\r\n  }\r\n\r\n  const cachedAuthors = await Kv.get('readonly.link/AuthorList/state.authors')\r\n  if (cachedAuthors) {\r\n    state.authors = cachedAuthors\r\n    state.isLoadedFromCache = true\r\n  } else {\r\n    await stateRefresh(state)\r\n  }\r\n\r\n  return state\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { reactive, ref, watchEffect } from 'vue'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\nimport AuthorListLoaded from './AuthorListLoaded.vue'\r\nimport AuthorListLoading from './AuthorListLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nconst state = ref<undefined | State>(undefined)\r\n\r\nwatchEffect(async () => {\r\n  state.value = reactive(await stateLoad())\r\n})\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <AuthorListLoaded v-if=\"state\" :state />\r\n    <AuthorListLoading v-else />\r\n  </PageLayout>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { join } from 'path-browserify'\r\nimport { computed } from 'vue'\r\nimport MdPage from '../../components/md/MdPage.vue'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { Activity } from '../../models/activity/Activity'\r\nimport { authorAvatarURL } from '../../models/author'\r\nimport { formatDateTime } from '../../utils/formatDate'\r\n\r\nconst props = defineProps<{\r\n  activity: Activity\r\n}>()\r\n\r\nconst activityURL = computed(\r\n  () =>\r\n    new URL(\r\n      join(props.activity.author.config.src || '', props.activity.path),\r\n      props.activity.author.url,\r\n    ),\r\n)\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-col py-1.5\">\r\n    <div class=\"flex items-center space-x-2 overflow-auto py-2\">\r\n      <Hyperlink :href=\"`/authors/${activity.author.url}`\" class=\"shrink-0\">\r\n        <img\r\n          :src=\"authorAvatarURL(activity.author).href\"\r\n          :alt=\"activity.author.config.name\"\r\n          class=\"h-[4.2rem] w-[4.2rem]\"\r\n        />\r\n      </Hyperlink>\r\n\r\n      <div class=\"flex flex-col space-y-1 overflow-auto\">\r\n        <Hyperlink\r\n          :href=\"`/authors/${activity.author.url}`\"\r\n          class=\"shrink-0 overflow-x-auto whitespace-pre text-lg font-bold hover:text-stone-400\"\r\n        >\r\n          {{ activity.author.config.name }}\r\n        </Hyperlink>\r\n\r\n        <Hyperlink\r\n          :href=\"`/authors/${activity.author.url}`\"\r\n          class=\"shrink-0 overflow-x-auto whitespace-pre py-0.5 font-mono text-xs hover:underline\"\r\n        >\r\n          {{ activity.author.url }}\r\n        </Hyperlink>\r\n\r\n        <Hyperlink\r\n          :href=\"`/articles/${activityURL}`\"\r\n          class=\"shrink-0 overflow-x-auto whitespace-pre py-0.5 font-mono text-xs hover:underline\"\r\n        >\r\n          {{ formatDateTime(activity.document.attributes.date) }}\r\n        </Hyperlink>\r\n      </div>\r\n    </div>\r\n\r\n    <MdPage :document=\"activity.document\" :url=\"activityURL\" />\r\n  </div>\r\n</template>\r\n","import { Activity } from '../../models/activity/Activity'\r\n\r\nexport function sortActivities(activities: Array<Activity>): Array<Activity> {\r\n  activities = [...activities]\r\n\r\n  activities.sort((x, y) =>\r\n    comparisonFromBoolean(\r\n      new Date(x.document.attributes.date) <\r\n        new Date(y.document.attributes.date),\r\n    ),\r\n  )\r\n\r\n  return activities\r\n}\r\n\r\nfunction comparisonFromBoolean(p: boolean): 1 | -1 {\r\n  return p ? 1 : -1\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { computed } from 'vue'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { authorAvatarURL } from '../../models/author'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst avatarURL = computed(() =>\r\n  authorAvatarURL({\r\n    url: props.state.url,\r\n    config: props.state.config,\r\n  }),\r\n)\r\n</script>\r\n\r\n<template>\r\n  <Hyperlink :href=\"`/authors/${state.url}`\">\r\n    <img :src=\"avatarURL.href\" :alt=\"state.config.name\" />\r\n  </Hyperlink>\r\n</template>\r\n","<template>\r\n  <svg viewBox=\"0 0 24 24\">\r\n    <path\r\n      fill=\"currentColor\"\r\n      fill-rule=\"nonzero\"\r\n      d=\"M7.172 2.757L10.414 6h3.171l3.243-3.242a1 1 0 0 1 1.415 1.415l-1.829 1.827L18.5 6A3.5 3.5 0 0 1 22 9.5v8a3.5 3.5 0 0 1-3.5 3.5h-13A3.5 3.5 0 0 1 2 17.5v-8A3.5 3.5 0 0 1 5.5 6h2.085L5.757 4.171a1 1 0 0 1 1.415-1.415zM18.5 8h-13a1.5 1.5 0 0 0-1.493 1.356L4 9.5v8a1.5 1.5 0 0 0 1.356 1.493L5.5 19h13a1.5 1.5 0 0 0 1.493-1.356L20 17.5v-8A1.5 1.5 0 0 0 18.5 8zM8 11a1 1 0 0 1 1 1v2a1 1 0 0 1-2 0v-2a1 1 0 0 1 1-1zm8 0a1 1 0 0 1 1 1v2a1 1 0 0 1-2 0v-2a1 1 0 0 1 1-1z\"\r\n    />\r\n  </svg>\r\n</template>\r\n","<template>\r\n  <svg viewBox=\"0 0 14 14\" aria-label=\"github\">\r\n    <path\r\n      d=\"M7 .175c-3.872 0-7 3.128-7 7 0 3.084 2.013 5.71 4.79 6.65.35.066.482-.153.482-.328v-1.181c-1.947.415-2.363-.941-2.363-.941-.328-.81-.787-1.028-.787-1.028-.634-.438.044-.416.044-.416.7.044 1.071.722 1.071.722.635 1.072 1.641.766 2.035.59.066-.459.24-.765.437-.94-1.553-.175-3.193-.787-3.193-3.456 0-.766.262-1.378.721-1.881-.065-.175-.306-.897.066-1.86 0 0 .59-.197 1.925.722a6.754 6.754 0 0 1 1.75-.24c.59 0 1.203.087 1.75.24 1.335-.897 1.925-.722 1.925-.722.372.963.131 1.685.066 1.86.46.48.722 1.115.722 1.88 0 2.691-1.641 3.282-3.194 3.457.24.219.481.634.481 1.29v1.926c0 .197.131.415.481.328C11.988 12.884 14 10.259 14 7.175c0-3.872-3.128-7-7-7z\"\r\n      fill=\"currentColor\"\r\n      fill-rule=\"nonzero\"\r\n    ></path>\r\n  </svg>\r\n</template>\r\n","<template>\r\n  <!-- Generated from: https://danmarshall.github.io/google-font-to-svg-path/ -->\r\n\r\n  <svg\r\n    width=\"177.1\"\r\n    height=\"53.1\"\r\n    viewBox=\"0 0 177.1 53.1\"\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n  >\r\n    <g\r\n      id=\"svgGroup\"\r\n      stroke-linecap=\"round\"\r\n      fill-rule=\"nonzero\"\r\n      font-size=\"9pt\"\r\n      fill=\"currentColor\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"0.25mm\"\r\n    >\r\n      <path\r\n        d=\"M 55.8 53.1 L 50.8 53.1 L 50.8 1.1 L 55.6 1.1 L 56.1 13.7 L 54.9 13.5 Q 55.8 10.3 57.75 7.8 Q 59.7 5.3 62.35 3.55 Q 65 1.8 68.2 0.9 A 24.435 24.435 0 0 1 73.664 0.032 A 27.936 27.936 0 0 1 75 0 A 19.319 19.319 0 0 1 79.39 0.483 A 16.506 16.506 0 0 1 81.95 1.3 A 11.09 11.09 0 0 1 85.596 3.787 A 15.254 15.254 0 0 1 87.4 6 A 17.96 17.96 0 0 1 88.969 8.909 Q 89.633 10.436 90.178 12.294 A 43.394 43.394 0 0 1 91 15.6 L 89 14.2 L 89.7 12.5 A 16.875 16.875 0 0 1 91.5 9.271 A 20.575 20.575 0 0 1 92.6 7.85 A 21.569 21.569 0 0 1 96.773 4.075 A 24.162 24.162 0 0 1 97.1 3.85 Q 99.7 2.1 102.95 1.05 A 22.033 22.033 0 0 1 108.755 0.026 A 25.362 25.362 0 0 1 109.9 0 A 19.69 19.69 0 0 1 114.163 0.441 A 14.749 14.749 0 0 1 118.8 2.3 A 13.181 13.181 0 0 1 122.982 6.52 A 18.046 18.046 0 0 1 124.45 9.4 A 23.719 23.719 0 0 1 125.713 13.729 Q 126.4 17.207 126.4 21.6 L 126.4 53.1 L 121.4 53.1 L 121.4 21.8 A 38.225 38.225 0 0 0 121.213 17.896 Q 121.015 15.97 120.607 14.341 A 17.754 17.754 0 0 0 119.95 12.25 A 13.453 13.453 0 0 0 118.445 9.379 A 10.127 10.127 0 0 0 115.65 6.65 A 11.129 11.129 0 0 0 111.818 5.112 A 15.788 15.788 0 0 0 108.6 4.8 A 19.512 19.512 0 0 0 104.216 5.276 A 16.472 16.472 0 0 0 101.5 6.15 A 17.374 17.374 0 0 0 96.933 8.938 A 16.168 16.168 0 0 0 96 9.8 Q 93.7 12.1 92.4 15.05 Q 91.1 18 91.1 21.3 L 91.1 53.1 L 86.1 53.1 L 86.1 21.8 A 38.225 38.225 0 0 0 85.913 17.896 Q 85.715 15.97 85.307 14.341 A 17.754 17.754 0 0 0 84.65 12.25 A 13.161 13.161 0 0 0 83.104 9.333 A 10.11 10.11 0 0 0 80.3 6.65 A 11.492 11.492 0 0 0 76.297 5.085 A 16.028 16.028 0 0 0 73.2 4.8 A 18.721 18.721 0 0 0 68.471 5.382 A 16.554 16.554 0 0 0 66.2 6.15 A 17.374 17.374 0 0 0 61.633 8.938 A 16.168 16.168 0 0 0 60.7 9.8 Q 58.4 12.1 57.1 15.05 Q 55.8 18 55.8 21.3 L 55.8 53.1 Z M 37.5 46.9 L 35.2 50.6 L 0 30.4 L 0 25.3 L 35.2 5.1 L 37.5 8.8 L 2.5 29 L 2.5 26.7 L 37.5 46.9 Z M 177.1 30.4 L 141.9 50.6 L 139.6 46.9 L 174.6 26.7 L 174.6 29 L 139.6 8.8 L 141.9 5.1 L 177.1 25.3 L 177.1 30.4 Z\"\r\n        vector-effect=\"non-scaling-stroke\"\r\n      />\r\n    </g>\r\n  </svg>\r\n</template>\r\n","<template>\r\n  <svg viewBox=\"0 0 300 300\" fill=\"currentColor\" stroke=\"currentColor\">\r\n    <path\r\n      d=\"M178.57 127.15 290.27 0h-26.46l-97.03 110.38L89.34 0H0l117.13 166.93L0 300.25h26.46l102.4-116.59 81.8 116.59h89.34M36.01 19.54H76.66l187.13 262.13h-40.66\"\r\n    />\r\n  </svg>\r\n</template>\r\n","import { reactive, watch } from 'vue'\r\nimport { Following } from './Following'\r\n\r\nexport const globalFollowing: Following = reactive({\r\n  list: [],\r\n})\r\n\r\nwatch(\r\n  () => globalFollowing.list,\r\n  (value) => {\r\n    const listText = value.join('\\n')\r\n    window.localStorage.setItem('globalFollowing.list', listText)\r\n  },\r\n  {\r\n    deep: true,\r\n  },\r\n)\r\n","import { Following } from './Following'\r\nimport { globalFollowing } from './globalFollowing'\r\n\r\nlet initialized = false\r\n\r\nexport function useFollowing(): Following {\r\n  if (initialized) {\r\n    return globalFollowing\r\n  }\r\n\r\n  globalFollowing.list = loadList()\r\n\r\n  initialized = true\r\n\r\n  return globalFollowing\r\n}\r\n\r\nfunction loadList(): Array<string> {\r\n  const listText = window.localStorage.getItem('globalFollowing.list')\r\n  if (!listText) {\r\n    return []\r\n  }\r\n\r\n  return listText.split('\\n')\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { ArrowTopRightOnSquareIcon } from '@heroicons/vue/24/outline'\r\nimport { useRoute } from 'vue-router'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { useFollowing } from '../../models/following'\r\nimport { useGlobalTheme } from '../../models/theme'\r\nimport { currentOrigin } from '../../utils/currentOrigin'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst route = useRoute()\r\nconst origin = currentOrigin()\r\nconst theme = useGlobalTheme()\r\nconst lang = useGlobalLang()\r\nconst following = useFollowing()\r\n\r\nfunction isFollowed() {\r\n  return following.list.includes(props.state.url)\r\n}\r\n\r\nfunction follow() {\r\n  if (!isFollowed()) {\r\n    following.list = [...following.list, props.state.url]\r\n  }\r\n}\r\n\r\nfunction unfollow() {\r\n  following.list = following.list.filter((url) => url !== props.state.url)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-wrap text-xl text-stone-400\">\r\n    <div class=\"flex flex-col items-start space-y-1 pb-6 pr-8\">\r\n      <button\r\n        class=\"flex items-center whitespace-nowrap hover:text-black hover:underline dark:hover:text-white\"\r\n        @click=\"lang.isZh() ? (lang.tag = 'en') : (lang.tag = 'zh')\"\r\n      >\r\n        <Lang>\r\n          <template #zh>中文/English</template>\r\n          <template #en>English/中文</template>\r\n        </Lang>\r\n      </button>\r\n\r\n      <button\r\n        class=\"flex items-center whitespace-nowrap hover:text-black dark:hover:text-white\"\r\n        @click=\"\r\n          theme.name !== 'dark' ? (theme.name = 'dark') : (theme.name = 'light')\r\n        \"\r\n      >\r\n        <Lang>\r\n          <template #zh>\r\n            <span v-if=\"theme.name === 'dark'\">深色/浅色</span>\r\n            <span v-else>浅色/深色</span>\r\n          </template>\r\n          <template #en>\r\n            <span v-if=\"theme.name === 'dark'\">Dark/Light</span>\r\n            <span v-else>Light/Dark</span>\r\n          </template>\r\n        </Lang>\r\n      </button>\r\n\r\n      <button\r\n        v-if=\"!isFollowed()\"\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        @click=\"follow()\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 取关/关注 </template>\r\n          <template #en> Unfollow/Follow </template>\r\n        </Lang>\r\n      </button>\r\n\r\n      <button\r\n        v-if=\"isFollowed()\"\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        @click=\"unfollow()\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 关注/取关 </template>\r\n          <template #en> Follow/Unfollow </template>\r\n        </Lang>\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"flex flex-col items-start space-y-1 pb-6 pr-8\">\r\n      <Hyperlink\r\n        :href=\"`/authors/${state.url}/-/${state.config.homepage}`\"\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        :class=\"{\r\n          'text-black dark:text-white': state.path === state.config.homepage,\r\n        }\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 首页 </template>\r\n          <template #en> Homepage </template>\r\n        </Lang>\r\n      </Hyperlink>\r\n\r\n      <Hyperlink\r\n        :href=\"`/authors/${state.url}/-/activities`\"\r\n        class=\"hover:text-black dark:hover:text-white\"\r\n        :class=\"{\r\n          'text-black dark:text-white': state.path === 'activities',\r\n        }\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 动态 </template>\r\n          <template #en> Activities </template>\r\n        </Lang>\r\n      </Hyperlink>\r\n    </div>\r\n\r\n    <div class=\"flex flex-col items-start space-y-1 pb-6 pr-8\">\r\n      <a\r\n        href=\"/\"\r\n        target=\"_blank\"\r\n        class=\"flex items-center hover:text-black dark:hover:text-white\"\r\n      >\r\n        <Lang>\r\n          <template #zh> 只读链接 </template>\r\n          <template #en> Readonly.Link </template>\r\n        </Lang>\r\n\r\n        <ArrowTopRightOnSquareIcon class=\"ml-0.5 h-4 w-4\" />\r\n      </a>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { useRoute } from 'vue-router'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { State } from './State'\r\n\r\ndefineProps<{\r\n  state: State\r\n  tabs: Record<string, string>\r\n}>()\r\n\r\nconst route = useRoute()\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-wrap py-2\">\r\n    <Hyperlink\r\n      v-for=\"(path, name) of tabs\"\r\n      :key=\"name\"\r\n      class=\"mr-3 text-xl hover:text-black dark:hover:text-white\"\r\n      :class=\"{\r\n        'text-black dark:text-white': route.path.endsWith(`/-/${path}`),\r\n        'text-stone-400': !route.path.endsWith(`/-/${path}`),\r\n      }\"\r\n      :href=\"`/authors/${state.url}/-/${path}`\"\r\n    >\r\n      {{ name }}\r\n    </Hyperlink>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Document } from '@xieyuheng/x-markdown'\r\nimport { join } from 'path-browserify'\r\nimport { computed, watch } from 'vue'\r\nimport MdPage from '../../components/md/MdPage.vue'\r\nimport AuthorActivities from './AuthorActivities.vue'\r\nimport AuthorHead from './AuthorHead.vue'\r\nimport AuthorPageNotFound from './AuthorPageNotFound.vue'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  document?: Document\r\n}>()\r\n\r\nwatch(\r\n  () => props.state.path,\r\n  () => {\r\n    window.scrollTo(0, 0)\r\n  },\r\n)\r\n\r\nconst url = computed(() => {\r\n  if (props.state.path === undefined) {\r\n    return new URL(props.state.url)\r\n  }\r\n\r\n  if (props.state.config.src) {\r\n    return new URL(\r\n      join(props.state.config.src, props.state.path),\r\n      props.state.url,\r\n    )\r\n  }\r\n\r\n  return new URL(props.state.path, props.state.url)\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"h-screen-dynamic overflow-auto bg-white text-black dark:bg-black dark:text-white\"\r\n  >\r\n    <div class=\"relative mx-auto flex max-w-3xl flex-col p-5\">\r\n      <AuthorHead :state />\r\n      <AuthorActivities v-if=\"state.path === 'activities'\" :state />\r\n      <MdPage v-else-if=\"document\" :document=\"document\" :url=\"url\" />\r\n      <AuthorPageNotFound v-else :state />\r\n    </div>\r\n  </div>\r\n</template>\r\n","import { Document } from '@xieyuheng/x-markdown'\r\nimport { State } from './State'\r\n\r\nexport function stateCurrentDocument(state: State): Document | undefined {\r\n  if (state.path === undefined) {\r\n    return undefined\r\n  }\r\n\r\n  return state.documents[state.path]\r\n}\r\n","import qs from 'qs'\r\nimport { watch } from 'vue'\r\nimport { Router } from 'vue-router'\r\nimport { State } from './State'\r\n\r\nfunction currentQuery() {\r\n  const url = new URL(window.location.href)\r\n  const query = qs.parse(url.search, { ignoreQueryPrefix: true })\r\n  return query\r\n}\r\n\r\nexport function stateReactivelyUpdateRoute(state: State, router: Router): void {\r\n  watch(\r\n    () => state.path,\r\n    (value) => {\r\n      if (value === undefined) {\r\n        router.replace({\r\n          path: `/authors/${state.url}`,\r\n          query: {\r\n            ...(currentQuery() as any),\r\n          },\r\n        })\r\n      } else {\r\n        router.replace({\r\n          path: `/authors/${state.url}/-/${value}`,\r\n          query: {\r\n            ...(currentQuery() as any),\r\n          },\r\n        })\r\n      }\r\n    },\r\n    {\r\n      immediate: true,\r\n    },\r\n  )\r\n}\r\n","export function isValidDate(date: any): boolean {\r\n  return !Number.isNaN(new Date(date).getTime())\r\n}\r\n","import { parseDocument } from '@xieyuheng/x-markdown'\r\nimport { join } from 'path-browserify'\r\nimport { isValidDate } from '../../utils/isValidDate'\r\nimport { Author } from '../author/Author'\r\nimport { Activity } from './Activity'\r\n\r\nexport async function loadActivity(\r\n  author: Author,\r\n  path: string,\r\n): Promise<Activity> {\r\n  const who = 'loadActivity'\r\n\r\n  const response = await fetch(\r\n    new URL(join(author.config.src || '', path), author.url),\r\n  )\r\n\r\n  const text = await response.text()\r\n  const document = parseDocument(text)\r\n  if (!isValidDate(document.attributes.date)) {\r\n    throw new Error(\r\n      `[${who}] document has no valid date attribute: ${document.attributes.date}`,\r\n    )\r\n  }\r\n\r\n  document.attributes.kind = 'Activity'\r\n\r\n  return { author, path, text, document }\r\n}\r\n","import { promiseAllFulfilled } from '../../utils/promiseAllFulfilled'\r\nimport { Author } from '../author/Author'\r\nimport { Activity } from './Activity'\r\nimport { loadActivity } from './loadActivity'\r\n\r\nexport async function loadActivitiesFromAuthors(\r\n  authors: Array<Author>,\r\n): Promise<Array<Activity>> {\r\n  return (\r\n    await promiseAllFulfilled(authors.map(loadActivitiesFromAuthor))\r\n  ).flatMap((activities) => activities)\r\n}\r\n\r\nasync function loadActivitiesFromAuthor(\r\n  author: Author,\r\n): Promise<Array<Activity>> {\r\n  return await promiseAllFulfilled(\r\n    author.config.activities.map((path) => loadActivity(author, path)),\r\n  )\r\n}\r\n","import { Document, parseDocument } from '@xieyuheng/x-markdown'\r\nimport { join } from 'path-browserify'\r\nimport { loadActivitiesFromAuthors } from '../../models/activity/loadActivitiesFromAuthors'\r\nimport { loadAuthor } from '../../models/author'\r\nimport { useHistory } from '../../models/history/useHistory'\r\nimport { promiseAllFulfilled } from '../../utils/promiseAllFulfilled'\r\nimport { stringTrimEnd } from '../../utils/stringTrimEnd'\r\nimport { State } from './State'\r\n\r\nexport type StateOptions = {\r\n  url: string\r\n  path?: string\r\n}\r\n\r\nexport async function stateLoad(options: StateOptions): Promise<State> {\r\n  const { path } = options\r\n  const url = stringTrimEnd(options.url, '/')\r\n\r\n  const history = await useHistory()\r\n  history.record[url] = { time: Date.now(), url }\r\n\r\n  const author = await loadAuthor(url)\r\n  const config = author.config\r\n\r\n  const paths = [...Object.values(config.tabs || {}), config.homepage]\r\n  const texts: Record<string, string> = Object.fromEntries(\r\n    await promiseAllFulfilled(\r\n      paths.map(async (path) => {\r\n        const response = await fetch(new URL(join(config.src || '', path), url))\r\n        const text = await response.text()\r\n        return [path, text]\r\n      }),\r\n    ),\r\n  )\r\n\r\n  const documents: Record<string, Document> = {}\r\n  for (const [path, text] of Object.entries(texts)) {\r\n    documents[path] = parseDocument(text)\r\n  }\r\n\r\n  const activities = await loadActivitiesFromAuthors([author])\r\n\r\n  return {\r\n    url,\r\n    path,\r\n    config,\r\n    activities,\r\n    author,\r\n    documents,\r\n  }\r\n}\r\n","import * as Kv from 'idb-keyval'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nexport async function stateRefresh(state: State): Promise<void> {\r\n  const store = Kv.createStore('readonly.link/authors', 'cache')\r\n  const newState = await stateLoad(state)\r\n  delete newState.path\r\n  Object.assign(state, newState)\r\n  await Kv.set(state.url, newState, store)\r\n}\r\n","import { State } from './State'\r\n\r\nexport function stateTitle(state: State): string {\r\n  if (state.path === undefined) {\r\n    return state.config.name\r\n  }\r\n\r\n  if (state.path === state.config.homepage) {\r\n    return state.config.name\r\n  }\r\n\r\n  if (state.path === 'activities') {\r\n    return `activities | ${state.config.name}`\r\n  }\r\n\r\n  for (const [name, path] of Object.entries(state.config.tabs || {})) {\r\n    if (path === state.path) {\r\n      return `${name} | ${state.config.name}`\r\n    }\r\n  }\r\n\r\n  return state.config.name\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Head } from '@vueuse/head'\r\nimport { onMounted, watchEffect } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport AuthorPage from './AuthorPage.vue'\r\nimport { State } from './State'\r\nimport { stateCurrentDocument } from './stateCurrentDocument'\r\nimport { stateReactivelyUpdateRoute } from './stateReactivelyUpdateRoute'\r\nimport { stateRefresh } from './stateRefresh'\r\nimport { stateTitle } from './stateTitle'\r\n\r\nconst props = defineProps<{ state: State }>()\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\nstateReactivelyUpdateRoute(props.state, router)\r\n\r\nonMounted(async () => {\r\n  if (props.state.isLoadedFromCache) {\r\n    await stateRefresh(props.state)\r\n  }\r\n})\r\n\r\nwatchEffect(() => {\r\n  props.state.path = route.params.path\r\n    ? String(route.params.path)\r\n    : props.state.config.homepage\r\n})\r\n</script>\r\n\r\n<template>\r\n  <Head>\r\n    <title>{{ stateTitle(state) }}</title>\r\n  </Head>\r\n\r\n  <AuthorPage\r\n    :state\r\n    :document=\"stateCurrentDocument(state)\"\r\n    :key=\"state.path\"\r\n  />\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { stringTrimEnd } from '../../utils/stringTrimEnd'\r\nimport { State } from './State'\r\nimport { StateOptions, stateLoad } from './stateLoad'\r\n\r\nexport async function stateLoadFromCacheFirst(\r\n  options: StateOptions,\r\n): Promise<State> {\r\n  const { path } = options\r\n  const url = stringTrimEnd(options.url, '/')\r\n\r\n  const store = Kv.createStore('readonly.link/authors', 'cache')\r\n  const cached = await Kv.get(url, store)\r\n  if (cached) {\r\n    return {\r\n      ...cached,\r\n      path,\r\n      url,\r\n      isLoadedFromCache: true,\r\n    }\r\n  } else {\r\n    const state = await stateLoad(options)\r\n    await Kv.set(url, state, store)\r\n    return state\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { reactive, ref, watchEffect } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport AuthorLoaded from './AuthorLoaded.vue'\r\nimport AuthorLoading from './AuthorLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoadFromCacheFirst } from './stateLoadFromCacheFirst'\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nconst route = useRoute()\r\n\r\nfunction useStateOptions() {\r\n  const url = String(route.params.url)\r\n  const path = route.params.path ? String(route.params.path) : undefined\r\n\r\n  return { url, path }\r\n}\r\n\r\nwatchEffect(async () => {\r\n  state.value = reactive(await stateLoadFromCacheFirst(useStateOptions()))\r\n})\r\n</script>\r\n\r\n<template>\r\n  <AuthorLoaded v-if=\"state\" :state />\r\n  <AuthorLoading v-else :options=\"useStateOptions()\" />\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { PlayIcon, QuestionMarkCircleIcon } from '@heroicons/vue/24/outline'\r\nimport { Head } from '@vueuse/head'\r\nimport { useRouter } from 'vue-router'\r\nimport { formSubmit, useForm } from '../../components/form'\r\nimport FormInput from '../../components/form/FormInput.vue'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\n\r\nconst form = useForm({\r\n  url: '',\r\n})\r\n\r\nconst lang = useGlobalLang()\r\n\r\nconst origin = window.location.origin\r\n\r\nconst router = useRouter()\r\n\r\nasync function submit(event: Event) {\r\n  formSubmit(form, event, async ({ url }) => {\r\n    router.push({ path: `/books/${url}` })\r\n  })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <div class=\"flex h-full max-w-3xl flex-col justify-center\">\r\n      <Head>\r\n        <title v-if=\"lang.isZh()\">书籍</title>\r\n        <title v-else>Book</title>\r\n      </Head>\r\n\r\n      <form @submit.prevent=\"submit\">\r\n        <FormInput name=\"url\" type=\"url\" :form=\"form\">\r\n          <template #label>\r\n            <div\r\n              class=\"flex items-end justify-between\"\r\n              title=\"Book | Readonly.Link Manual\"\r\n            >\r\n              <Lang class=\"text-2xl font-bold\">\r\n                <template #zh> 书籍 </template>\r\n                <template #en> Book </template>\r\n              </Lang>\r\n              <Hyperlink\r\n                :href=\"\r\n                  lang.isZh()\r\n                    ? `/manuals/${origin}/contents/manual/zh.json/-/kinds-of-contents/book.md`\r\n                    : `/manuals/${origin}/contents/manual/en.json/-/kinds-of-contents/book.md`\r\n                \"\r\n              >\r\n                <QuestionMarkCircleIcon class=\"h-6 w-6\" />\r\n              </Hyperlink>\r\n            </div>\r\n          </template>\r\n\r\n          <template #input-end>\r\n            <button class=\"px-4\">\r\n              <PlayIcon class=\"w-6\" />\r\n            </button>\r\n          </template>\r\n        </FormInput>\r\n      </form>\r\n\r\n      <div class=\"py-16\"></div>\r\n    </div>\r\n  </PageLayout>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { onMounted } from 'vue'\r\nimport { documentTitle } from '../../components/md/documentTitle'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { State } from './State'\r\n\r\ndefineProps<{ state: State }>()\r\n\r\nonMounted(() => {\r\n  window.scrollTo(0, 0)\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"min-h-screen-dynamic flex flex-col justify-center px-6 py-12 text-2xl\"\r\n  >\r\n    <div v-for=\"(document, path) in state.documents\" :key=\"path\">\r\n      <div class=\"py-2\">\r\n        <div class=\"flex flex-wrap items-baseline text-balance\">\r\n          <Hyperlink\r\n            :href=\"`/books/${state.url}/-/${path}`\"\r\n            class=\"font-bold hover:text-stone-500 hover:dark:text-stone-400\"\r\n          >\r\n            {{ documentTitle(document) }}\r\n          </Hyperlink>\r\n\r\n          <Hyperlink\r\n            :href=\"`/books/${state.url}/-/${path}`\"\r\n            class=\"pl-3 hover:text-stone-500 hover:dark:text-stone-400\"\r\n          >\r\n            {{ document.attributes.subtitle }}\r\n          </Hyperlink>\r\n        </div>\r\n\r\n        <div class=\"py-0.5 text-right\">\r\n          <Hyperlink\r\n            :href=\"`/books/${state.url}/-/${path}`\"\r\n            class=\"text-xs leading-3 tracking-tight text-stone-500 hover:text-black dark:text-stone-400 dark:hover:text-white\"\r\n          >\r\n            {{ path }}\r\n          </Hyperlink>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n","import { State } from './State'\r\n\r\nexport function statePaths(state: State): Array<string> {\r\n  return Object.keys(state.texts)\r\n}\r\n","import { State } from './State'\r\nimport { statePaths } from './statePaths'\r\n\r\nexport function stateNextPath(state: State): string | undefined {\r\n  if (state.path === undefined) {\r\n    return undefined\r\n  }\r\n\r\n  const paths = statePaths(state)\r\n  const index = paths.indexOf(state.path)\r\n  return paths[index + 1]\r\n}\r\n","import { State } from './State'\r\nimport { statePaths } from './statePaths'\r\n\r\nexport function statePrevPath(state: State): string | undefined {\r\n  if (state.path === undefined) {\r\n    return undefined\r\n  }\r\n\r\n  const paths = statePaths(state)\r\n  const index = paths.indexOf(state.path)\r\n  return paths[index - 1]\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Document } from '@xieyuheng/x-markdown'\r\nimport { join } from 'path-browserify'\r\nimport { computed, ref, watch } from 'vue'\r\nimport MdPage from '../../components/md/MdPage.vue'\r\nimport BookPageNav from './BookPageNav.vue'\r\nimport BookPageNotFound from './BookPageNotFound.vue'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  document?: Document\r\n}>()\r\n\r\nconst topElement = ref<HTMLDivElement | undefined>()\r\n\r\nwatch(\r\n  () => props.state.path,\r\n  () => {\r\n    topElement.value?.scrollIntoView()\r\n  },\r\n  {\r\n    immediate: true,\r\n  },\r\n)\r\n\r\nconst url = computed(() => {\r\n  if (props.state.path === undefined) {\r\n    return new URL(props.state.url)\r\n  }\r\n\r\n  return new URL(\r\n    join(props.state.config.src, props.state.path),\r\n    props.state.url,\r\n  )\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"h-screen-dynamic flex flex-col px-6\">\r\n    <div ref=\"topElement\"></div>\r\n    <BookPageNav class=\"py-6\" :state />\r\n    <MdPage v-if=\"document\" :key=\"state.path\" :document=\"document\" :url=\"url\" />\r\n    <BookPageNotFound v-else :state />\r\n    <BookPageNav class=\"py-6\" :state />\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { BookOpenIcon, LanguageIcon } from '@heroicons/vue/24/outline'\r\nimport { computed } from 'vue'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { normalizeAttributes } from '../../components/md/normalizeAttributes'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst attributes = computed(() => normalizeAttributes(props.state.config))\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"h-screen-dynamic flex flex-col items-center justify-between py-12 text-2xl\"\r\n  >\r\n    <div class=\"flex flex-col items-center space-y-2 py-4 text-3xl sm:text-4xl\">\r\n      <div class=\"px-2 text-center font-bold\">\r\n        {{ state.config.title }}\r\n      </div>\r\n\r\n      <div class=\"px-2 text-center text-xl sm:text-2xl\">\r\n        {{ state.config.subtitle }}\r\n      </div>\r\n\r\n      <div v-if=\"state.config.version\" class=\"px-2 text-lg\">\r\n        {{ state.config.version }}\r\n      </div>\r\n\r\n      <Hyperlink :href=\"`/books/${state.url}?front-matter=contents`\">\r\n        <div\r\n          class=\"flex items-center space-x-0.5 py-2 font-bold text-stone-400 hover:text-black dark:hover:text-white\"\r\n        >\r\n          <BookOpenIcon class=\"w-5 pb-0.5\" />\r\n\r\n          <Lang class=\"text-xl\">\r\n            <template #zh> 阅读 </template>\r\n            <template #en> Read </template>\r\n          </Lang>\r\n        </div>\r\n      </Hyperlink>\r\n    </div>\r\n\r\n    <section class=\"py-4\">\r\n      <div\r\n        v-if=\"attributes.authors.length > 0\"\r\n        class=\"flex flex-col items-center py-1.5\"\r\n      >\r\n        <div\r\n          class=\"py-1 font-bold\"\r\n          v-for=\"(name, index) in attributes.authors\"\r\n          :key=\"index\"\r\n        >\r\n          {{ name }}\r\n        </div>\r\n      </div>\r\n\r\n      <div\r\n        v-if=\"attributes.translators.length > 0\"\r\n        class=\"flex flex-col items-center\"\r\n      >\r\n        <div class=\"flex items-center pr-3 text-center text-xl font-bold\">\r\n          <LanguageIcon class=\"w-5 pr-1\" />\r\n          {{ attributes.translators.join(', ') }}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"flex flex-col items-center px-2\">\r\n        <div v-if=\"state.config.year\" class=\"text text-lg\">\r\n          {{ state.config.year }}\r\n        </div>\r\n        <div v-else-if=\"state.config.date\" class=\"text text-lg\">\r\n          {{ state.config.date }}\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <section class=\"flex flex-col items-center px-2\">\r\n      <a\r\n        :href=\"state.url\"\r\n        class=\"flex flex-col items-center break-all py-1 font-mono text-base hover:text-stone-500 sm:flex-row hover:dark:text-stone-400\"\r\n        target=\"_blank\"\r\n      >\r\n        <span class=\"text-center\">{{ state.url }}</span>\r\n      </a>\r\n    </section>\r\n  </div>\r\n</template>\r\n","import { Document } from '@xieyuheng/x-markdown'\r\nimport { State } from './State'\r\n\r\nexport function stateCurrentDocument(state: State): Document | undefined {\r\n  if (state.path === undefined) {\r\n    return undefined\r\n  }\r\n\r\n  return state.documents[state.path]\r\n}\r\n","import { z, ZodType } from 'zod'\r\n\r\nexport type BookConfig = {\r\n  kind: 'Book'\r\n  title: string\r\n  subtitle?: string\r\n  version?: string\r\n  authors: Array<string>\r\n  translators?: Array<string>\r\n  year?: string\r\n  date?: string\r\n  src: string\r\n  contents: Array<string>\r\n}\r\n\r\nexport const BookConfigSchema: ZodType<BookConfig> = z.object({\r\n  kind: z.literal('Book'),\r\n  title: z.string(),\r\n  subtitle: z.optional(z.string()),\r\n  version: z.optional(z.string()),\r\n  authors: z.array(z.string()),\r\n  translators: z.optional(z.array(z.string())),\r\n  year: z.optional(z.string()),\r\n  date: z.optional(z.string()),\r\n  src: z.string(),\r\n  contents: z.array(z.string()),\r\n})\r\n","import { BookConfig, BookConfigSchema } from './BookConfig'\r\n\r\nexport async function loadBookConfig(options: {\r\n  url: string\r\n}): Promise<BookConfig> {\r\n  const { url } = options\r\n\r\n  const response = await fetch(url)\r\n  const json = await response.json()\r\n\r\n  return BookConfigSchema.parse(json)\r\n}\r\n","import { parseDocument } from '@xieyuheng/x-markdown'\r\nimport { join } from 'path-browserify'\r\nimport { loadBookConfig } from '../../models/book/loadBookConfig'\r\nimport { useHistory } from '../../models/history/useHistory'\r\nimport { promiseAllFulfilled } from '../../utils/promiseAllFulfilled'\r\nimport { stringTrimEnd } from '../../utils/stringTrimEnd'\r\nimport { State } from './State'\r\n\r\nexport type StateOptions = {\r\n  url: string\r\n  path?: string\r\n  frontMatter?: string\r\n}\r\n\r\nexport async function stateLoad(options: StateOptions): Promise<State> {\r\n  const { path, frontMatter } = options\r\n\r\n  const url = stringTrimEnd(options.url, '/')\r\n  const config = await loadBookConfig({ url })\r\n\r\n  const texts: Record<string, string> = Object.fromEntries(\r\n    await promiseAllFulfilled(\r\n      config.contents.map(async (path) => {\r\n        const response = await fetch(new URL(join(config.src, path), url))\r\n        const text = await response.text()\r\n        return [path, text]\r\n      }),\r\n    ),\r\n  )\r\n\r\n  const documents = Object.fromEntries(\r\n    Object.entries(texts).map(([path, text]) => [path, parseDocument(text)]),\r\n  )\r\n\r\n  const history = await useHistory()\r\n  history.record[url] = { time: Date.now(), url }\r\n\r\n  return {\r\n    url,\r\n    path,\r\n    frontMatter,\r\n    config,\r\n    texts,\r\n    documents,\r\n  }\r\n}\r\n","import * as Kv from 'idb-keyval'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nexport async function stateRefresh(state: State): Promise<void> {\r\n  const store = Kv.createStore('readonly.link/books', 'cache')\r\n  const newState = await stateLoad(state)\r\n  delete newState.path\r\n  delete newState.frontMatter\r\n  Object.assign(state, newState)\r\n  await Kv.set(state.url, newState, store)\r\n}\r\n","import { documentTitle } from '../../components/md/documentTitle'\r\nimport { State } from './State'\r\nimport { stateCurrentDocument } from './stateCurrentDocument'\r\n\r\nexport function stateTitle(state: State): string {\r\n  const document = stateCurrentDocument(state)\r\n\r\n  if (document === undefined) {\r\n    return state.config.title\r\n  }\r\n\r\n  const subtitle = documentTitle(document)\r\n  if (subtitle === undefined) {\r\n    return state.config.title\r\n  }\r\n\r\n  return [subtitle, state.config.title].join(' | ')\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { useEventListener } from '@vueuse/core'\r\nimport { Head } from '@vueuse/head'\r\nimport { onMounted, watch } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport BookContents from './BookContents.vue'\r\nimport BookPage from './BookPage.vue'\r\nimport BookTitlePage from './BookTitlePage.vue'\r\nimport { State } from './State'\r\nimport { stateCurrentDocument } from './stateCurrentDocument'\r\nimport { stateNextPath } from './stateNextPath'\r\nimport { statePrevPath } from './statePrevPath'\r\nimport { stateRefresh } from './stateRefresh'\r\nimport { stateTitle } from './stateTitle'\r\n\r\nconst props = defineProps<{ state: State }>()\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\nonMounted(async () => {\r\n  if (props.state.isLoadedFromCache) {\r\n    await stateRefresh(props.state)\r\n  }\r\n})\r\n\r\nwatch(\r\n  () => route.query['front-matter'],\r\n  (value) => {\r\n    props.state.frontMatter = value ? String(value) : undefined\r\n  },\r\n)\r\n\r\nwatch(\r\n  () => route.params.path,\r\n  (value) => {\r\n    props.state.path = value ? String(value) : undefined\r\n  },\r\n)\r\n\r\nuseEventListener(window, 'keydown', (event) => {\r\n  if (event.altKey) return\r\n  if (event.ctrlKey) return\r\n\r\n  if (event.key === 'ArrowLeft') {\r\n    const path = statePrevPath(props.state)\r\n    if (path !== undefined) {\r\n      router.push(`/books/${props.state.url}/-/${path}`)\r\n    }\r\n  }\r\n\r\n  if (event.key === 'ArrowRight') {\r\n    const path = stateNextPath(props.state)\r\n    if (path !== undefined) {\r\n      router.push(`/books/${props.state.url}/-/${path}`)\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"h-screen-dynamic overflow-auto bg-white text-black dark:bg-black dark:text-white\"\r\n  >\r\n    <Head>\r\n      <title>{{ stateTitle(state) }}</title>\r\n    </Head>\r\n\r\n    <div class=\"mx-auto max-w-3xl\">\r\n      <BookContents v-if=\"state.frontMatter === 'contents'\" :state />\r\n      <BookTitlePage v-else-if=\"!state.path\" :state />\r\n      <BookPage v-else :state :document=\"stateCurrentDocument(state)\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { stringTrimEnd } from '../../utils/stringTrimEnd'\r\nimport { State } from './State'\r\nimport { StateOptions, stateLoad } from './stateLoad'\r\n\r\nexport async function stateLoadFromCacheFirst(\r\n  options: StateOptions,\r\n): Promise<State> {\r\n  const { path, frontMatter } = options\r\n  const url = stringTrimEnd(options.url, '/')\r\n  console.log(url);\r\n  const store = Kv.createStore('readonly.link/books', 'cache')\r\n  const cached = await Kv.get(url, store)\r\n  if (cached) {\r\n    return {\r\n      ...cached,\r\n      path,\r\n      frontMatter,\r\n      url,\r\n      isLoadedFromCache: true,\r\n    }\r\n  } else {\r\n    const state = await stateLoad(options)\r\n    await Kv.set(url, state, store)\r\n    return state\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { reactive, ref, watchEffect } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport BookLoaded from './BookLoaded.vue'\r\nimport BookLoading from './BookLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoadFromCacheFirst } from './stateLoadFromCacheFirst'\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nconst route = useRoute()\r\n\r\nfunction useStateOptions() {\r\n  const url = String(route.params.url)\r\n  const path = route.params.path ? String(route.params.path) : undefined\r\n  const frontMatter = route.query['front-matter']\r\n    ? String(route.query['front-matter'])\r\n    : undefined\r\n\r\n  return { url, path, frontMatter }\r\n}\r\n\r\nwatchEffect(async () => {\r\n  state.value = reactive(await stateLoadFromCacheFirst(useStateOptions()))\r\n})\r\n</script>\r\n\r\n<template>\r\n  <BookLoaded v-if=\"state\" :state />\r\n  <BookLoading v-else :options=\"useStateOptions()\" />\r\n</template>\r\n","import { parseDocument } from '@xieyuheng/x-markdown'\r\nimport { useGlobalTheme } from '../../models/theme'\r\nimport { State } from './State'\r\n\r\nexport function stateListenMessage(state: State): void {\r\n  const theme = useGlobalTheme()\r\n\r\n  window.addEventListener('message', (event) => {\r\n    console.log({\r\n      who: 'EmbeddedArticle',\r\n      message: 'receive message',\r\n      data: event.data,\r\n    })\r\n\r\n    if (typeof event.data.theme === 'string') {\r\n      theme.name = event.data.theme\r\n    }\r\n\r\n    if (event.data.document) {\r\n      state.document = event.data.document\r\n    } else if (typeof event.data.text === 'string') {\r\n      state.document = parseDocument(event.data.text)\r\n    }\r\n  })\r\n}\r\n","import { State } from './State'\r\nimport { stateListenMessage } from './stateListenMessage'\r\n\r\nexport function stateListen(state: State): void {\r\n  stateListenMessage(state)\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { onMounted, reactive } from 'vue'\r\nimport MdPage from '../../components/md/MdPage.vue'\r\nimport { State } from './State'\r\nimport { stateListen } from './stateListen'\r\n\r\nconst state = reactive<State>({})\r\n\r\nstateListen(state)\r\n\r\nonMounted(() => {\r\n  window.parent.postMessage({ message: 'mounted' }, '*')\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"overflow-auto bg-white text-black dark:bg-black dark:text-white\">\r\n    <div class=\"mx-auto max-w-3xl\">\r\n      <MdPage v-if=\"state.document\" :document=\"state.document\" />\r\n      <div v-else>Waiting for message...</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Head } from '@vueuse/head'\r\nimport { useRoute } from 'vue-router'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\n\r\nconst lang = useGlobalLang()\r\n\r\nconst route = useRoute()\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <Head>\r\n      <title v-if=\"lang.isZh()\">404 | 只读</title>\r\n      <title v-else>404 | Readonly</title>\r\n    </Head>\r\n\r\n    <div class=\"space-y-2 overflow-x-auto py-4\">\r\n      <div class=\"font-mono text-2xl\">404</div>\r\n      <div>\r\n        <Lang>\r\n          <template #zh> 没有这个页面。 </template>\r\n          <template #en> Page not found. </template>\r\n        </Lang>\r\n      </div>\r\n      <div class=\"overflow-x-auto font-mono text-sm\">{{ route.fullPath }}</div>\r\n    </div>\r\n  </PageLayout>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { ref } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useFollowing } from '../../models/following'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst following = useFollowing()\r\n\r\nconst text = ref<string>(following.list.join('\\n'))\r\n\r\nconst router = useRouter()\r\n\r\nasync function save() {\r\n  const list = text.value\r\n    .trim()\r\n    .split('\\n')\r\n    .map((url) => url.trim())\r\n  props.state.list = list\r\n  following.list = list\r\n  router.push('/following')\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex h-full flex-col\">\r\n    <div class=\"flex items-baseline justify-between\">\r\n      <Lang class=\"text-2xl font-bold\">\r\n        <template #zh> 关注列表 </template>\r\n        <template #en> Following </template>\r\n      </Lang>\r\n\r\n      <div class=\"flex justify-end py-1\">\r\n        <button\r\n          @click=\"save()\"\r\n          class=\"text-stone-400 hover:text-black dark:hover:text-white\"\r\n        >\r\n          <Lang>\r\n            <template #zh> 保存 </template>\r\n            <template #en> SAVE </template>\r\n          </Lang>\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <textarea\r\n      v-model=\"text\"\r\n      class=\"h-full border border-black bg-white p-2 text-black dark:border-white dark:bg-black dark:text-white\"\r\n    ></textarea>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { authorAvatarURL } from '../../models/author'\r\nimport { Author } from '../../models/author/Author'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  author: Author\r\n}>()\r\n\r\nfunction isCurrentAuthor() {\r\n  return props.state.currentAuthor?.url === props.author.url\r\n}\r\n\r\nfunction toggle() {\r\n  if (isCurrentAuthor()) {\r\n    props.state.currentAuthor = undefined\r\n  } else {\r\n    props.state.currentAuthor = props.author\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <button @click=\"toggle()\">\r\n    <div class=\"flex flex-col items-center\">\r\n      <img\r\n        class=\"h-[5rem] w-[5rem] shrink-0\"\r\n        :class=\"[isCurrentAuthor() && 'ring-4 ring-rose-300']\"\r\n        :src=\"authorAvatarURL(author).href\"\r\n        :alt=\"author.config.name\"\r\n      />\r\n\r\n      <div\r\n        class=\"w-[110px] overflow-x-auto whitespace-pre break-words py-1 text-center text-sm font-bold\"\r\n      >\r\n        {{ author.config.name }}\r\n      </div>\r\n    </div>\r\n  </button>\r\n</template>\r\n","import { Activity } from '../../models/activity/Activity'\r\nimport { sortActivities } from '../../models/activity/sortActivities'\r\nimport { State } from './State'\r\n\r\nexport function stateActivitiesForShow(state: State): Array<Activity> {\r\n  const activities = state.activities.filter(\r\n    (activity) =>\r\n      state.currentAuthor === undefined ||\r\n      activity.author.url === state.currentAuthor.url,\r\n  )\r\n\r\n  return sortActivities(activities)\r\n}\r\n","import { watch } from 'vue'\r\nimport { loadActivitiesFromAuthors } from '../../models/activity/loadActivitiesFromAuthors'\r\nimport { State } from './State'\r\n\r\nexport function stateReactivelyUpdateActivities(state: State) {\r\n  watch(\r\n    () => state.authors,\r\n    async () => {\r\n      state.activities = await loadActivitiesFromAuthors(state.authors)\r\n    },\r\n    {\r\n      immediate: true,\r\n      deep: true,\r\n    },\r\n  )\r\n}\r\n","import { watch } from 'vue'\r\nimport { loadAuthor } from '../../models/author'\r\nimport { useFollowing } from '../../models/following'\r\nimport { promiseAllFulfilled } from '../../utils/promiseAllFulfilled'\r\nimport { State } from './State'\r\n\r\nexport function stateReactivelyUpdateAuthors(state: State) {\r\n  const following = useFollowing()\r\n\r\n  watch(\r\n    () => following.list,\r\n    async (value) => {\r\n      state.list = value\r\n      state.authors = await promiseAllFulfilled(state.list.map(loadAuthor))\r\n    },\r\n    {\r\n      deep: true,\r\n    },\r\n  )\r\n}\r\n","import { State } from './State'\r\nimport { stateReactivelyUpdateActivities } from './stateReactivelyUpdateActivities'\r\nimport { stateReactivelyUpdateAuthors } from './stateReactivelyUpdateAuthors'\r\n\r\nexport function stateWatch(state: State): void {\r\n  stateReactivelyUpdateAuthors(state)\r\n  stateReactivelyUpdateActivities(state)\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Head } from '@vueuse/head'\r\nimport { watchEffect } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\nimport FollowingEditor from './FollowingEditor.vue'\r\nimport FollowingList from './FollowingList.vue'\r\nimport { State } from './State'\r\nimport { stateWatch } from './stateReactive'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst lang = useGlobalLang()\r\nconst route = useRoute()\r\n\r\nstateWatch(props.state)\r\n\r\nwatchEffect(() => {\r\n  if (route.query['kind']) {\r\n    props.state.kind = String(route.query['kind'])\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <Head>\r\n      <title v-if=\"lang.isZh()\">关注 | 只读</title>\r\n      <title v-else>Following | Readonly</title>\r\n    </Head>\r\n\r\n    <FollowingEditor v-if=\"state.kind === 'Editor'\" :state />\r\n    <FollowingList v-else :state />\r\n  </PageLayout>\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { loadActivitiesFromAuthors } from '../../models/activity/loadActivitiesFromAuthors'\r\nimport { loadAuthor } from '../../models/author'\r\nimport { promiseAllFulfilled } from '../../utils/promiseAllFulfilled'\r\nimport { State } from './State'\r\n\r\nexport async function stateRefresh(state: State): Promise<void> {\r\n  const authors = await promiseAllFulfilled(state.list.map(loadAuthor))\r\n  const activities = await loadActivitiesFromAuthors(authors)\r\n  state.authors = authors\r\n  state.activities = activities\r\n  await Kv.set('readonly.link/Following/state.authors', authors)\r\n  await Kv.set('readonly.link/Following/state.activities', activities)\r\n}\r\n","import * as Kv from 'idb-keyval'\r\nimport { State } from './State'\r\nimport { stateRefresh } from './stateRefresh'\r\n\r\nexport type StateOptions = {\r\n  kind?: string\r\n  list: Array<string>\r\n}\r\n\r\nexport async function stateLoad(options: StateOptions): Promise<State> {\r\n  const { kind, list } = options\r\n\r\n  const state: State = {\r\n    kind,\r\n    list,\r\n    authors: [],\r\n    activities: [],\r\n  }\r\n\r\n  const cachedAuthors = await Kv.get('readonly.link/Following/state.authors')\r\n  const cachedActivities = await Kv.get(\r\n    'readonly.link/Following/state.activities',\r\n  )\r\n  if (cachedAuthors && cachedActivities) {\r\n    state.authors = cachedAuthors\r\n    state.activities = cachedActivities\r\n    state.isLoadedFromCache = true\r\n  } else {\r\n    await stateRefresh(state)\r\n  }\r\n\r\n  return state\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { reactive, ref, watchEffect } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { useFollowing } from '../../models/following'\r\nimport FollowingLoaded from './FollowingLoaded.vue'\r\nimport FollowingLoading from './FollowingLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nconst route = useRoute()\r\n\r\nfunction useStateOptions() {\r\n  const following = useFollowing()\r\n  const list = following.list\r\n  const kind = route.query['kind'] ? String(route.query['kind']) : undefined\r\n\r\n  return {\r\n    kind,\r\n    list,\r\n  }\r\n}\r\n\r\nwatchEffect(async () => {\r\n  state.value = reactive(await stateLoad(useStateOptions()))\r\n})\r\n</script>\r\n\r\n<template>\r\n  <FollowingLoaded v-if=\"state\" :state />\r\n  <FollowingLoading v-else :options=\"useStateOptions()\" />\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { CalendarDaysIcon, TrashIcon } from '@heroicons/vue/24/outline'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport Readonlylink from '../../md-plugins/readonlylink/Readonlylink.vue'\r\nimport { HistoryEntry } from '../../models/history/History'\r\nimport { formatDateTime } from '../../utils/formatDate'\r\nimport { State } from './State'\r\n\r\ndefineProps<{\r\n  state: State\r\n  entry: HistoryEntry\r\n}>()\r\n\r\nconst lang = useGlobalLang()\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-col space-y-1\">\r\n    <div class=\"flex items-center space-x-1 overflow-auto\">\r\n      <CalendarDaysIcon class=\"h-5 w-5 shrink-0\" />\r\n      <span class=\"overflow-x-auto whitespace-pre\">{{\r\n        formatDateTime(entry.time)\r\n      }}</span>\r\n    </div>\r\n\r\n    <button\r\n      class=\"flex items-center space-x-1 hover:text-stone-500 hover:dark:text-stone-400\"\r\n      :title=\"lang.isZh() ? '删除这条记录' : 'Remove this record'\"\r\n      @click=\"delete state.history.record[entry.url]\"\r\n    >\r\n      <TrashIcon class=\"h-5 w-5 shrink-0\" />\r\n\r\n      <Lang class=\"text-lg\">\r\n        <template #zh>删除</template>\r\n        <template #en>Remove</template>\r\n      </Lang>\r\n    </button>\r\n\r\n    <Readonlylink :url=\"entry.url\" />\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Head } from '@vueuse/head'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\nimport HistoryEntry from './HistoryEntry.vue'\r\nimport { State } from './State'\r\n\r\ndefineProps<{ state: State }>()\r\n\r\nconst lang = useGlobalLang()\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <div class=\"flex h-full max-w-3xl flex-col\">\r\n      <Head>\r\n        <title v-if=\"lang.isZh()\">历史 | 只读</title>\r\n        <title v-else>History | Readonly</title>\r\n      </Head>\r\n\r\n      <Lang class=\"text-2xl font-bold\">\r\n        <template #zh> 历史 </template>\r\n        <template #en> History </template>\r\n      </Lang>\r\n\r\n      <Lang\r\n        v-if=\"Object.keys(state.history.record).length === 0\"\r\n        class=\"py-3 text-xl text-stone-500 dark:text-stone-400\"\r\n      >\r\n        <template #zh> 还没有历史记录。 </template>\r\n        <template #en> No history record yet. </template>\r\n      </Lang>\r\n\r\n      <div class=\"flex flex-col space-y-4 py-3\">\r\n        <HistoryEntry\r\n          v-for=\"(entry, key) of state.history.record\"\r\n          :key=\"key\"\r\n          :state\r\n          :entry=\"entry\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </PageLayout>\r\n</template>\r\n","import {\r\n  sortGlobalHistoryRecord,\r\n  useHistory,\r\n} from '../../models/history/useHistory'\r\nimport { State } from './State'\r\n\r\nexport type StateOptions = {}\r\n\r\nexport async function stateLoad(options: StateOptions): Promise<State> {\r\n  const history = await useHistory()\r\n\r\n  sortGlobalHistoryRecord()\r\n\r\n  return {\r\n    history,\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { onMounted, ref } from 'vue'\r\nimport HistoryLoaded from './HistoryLoaded.vue'\r\nimport HistoryLoading from './HistoryLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nconst options = {}\r\n\r\nonMounted(async () => {\r\n  state.value = await stateLoad(options)\r\n})\r\n</script>\r\n\r\n<template>\r\n  <HistoryLoaded v-if=\"state\" :state />\r\n  <HistoryLoading v-else options=\"options\" />\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { loadActivitiesFromAuthors } from '../../models/activity/loadActivitiesFromAuthors'\r\nimport { loadAuthor } from '../../models/author'\r\nimport { promiseAllFulfilled } from '../../utils/promiseAllFulfilled'\r\nimport { State } from './State'\r\n\r\nexport async function stateRefresh(state: State): Promise<void> {\r\n  const authors = await promiseAllFulfilled(state.list.map(loadAuthor))\r\n  const activities = await loadActivitiesFromAuthors(authors)\r\n  state.activities = activities\r\n  await Kv.set('readonly.link/Home/state.activities', activities)\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { onMounted } from 'vue'\r\nimport Activity from '../../components/activity/Activity.vue'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { sortActivities } from '../../models/activity/sortActivities'\r\nimport { State } from './State'\r\nimport { stateRefresh } from './stateRefresh'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nonMounted(async () => {\r\n  if (props.state.isLoadedFromCache) {\r\n    await stateRefresh(props.state)\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <Lang class=\"text-2xl font-bold\">\r\n      <template #zh> 作者动态 </template>\r\n      <template #en> Authors' activities </template>\r\n    </Lang>\r\n\r\n    <div class=\"border-b border-black pb-1 dark:border-white\"></div>\r\n\r\n    <div class=\"flex flex-col divide-y divide-black dark:divide-white\">\r\n      <Activity\r\n        v-for=\"activity of sortActivities(state.activities)\"\r\n        :key=\"activity.author.url + ' ' + activity.path\"\r\n        :activity=\"activity\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { State } from './State'\r\nimport { stateRefresh } from './stateRefresh'\r\n\r\nexport type StateOptions = {\r\n  list: Array<string>\r\n}\r\n\r\nexport async function stateLoad(options: StateOptions): Promise<State> {\r\n  const { list } = options\r\n\r\n  const state: State = {\r\n    list,\r\n    activities: [],\r\n  }\r\n\r\n  const cachedActivities = await Kv.get('readonly.link/Home/state.activities')\r\n  if (cachedActivities) {\r\n    state.activities = cachedActivities\r\n    state.isLoadedFromCache = true\r\n  } else {\r\n    await stateRefresh(state)\r\n  }\r\n\r\n  return state\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { reactive, ref, watchEffect } from 'vue'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\nimport { useDefaultAuthorList } from '../../models/author-list'\r\nimport HomeLoaded from './HomeLoaded.vue'\r\nimport HomeLoading from './HomeLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nfunction useStateOptions() {\r\n  const list = useDefaultAuthorList()\r\n\r\n  return {\r\n    list,\r\n  }\r\n}\r\n\r\nwatchEffect(async () => {\r\n  state.value = reactive(await stateLoad(useStateOptions()))\r\n})\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <HomeLoaded v-if=\"state\" :state />\r\n    <HomeLoading v-else :options=\"useStateOptions()\" />\r\n  </PageLayout>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { PlayIcon, QuestionMarkCircleIcon } from '@heroicons/vue/24/outline'\r\nimport { Head } from '@vueuse/head'\r\nimport { useRouter } from 'vue-router'\r\nimport { formSubmit, useForm } from '../../components/form'\r\nimport FormInput from '../../components/form/FormInput.vue'\r\nimport Lang from '../../components/lang/Lang.vue'\r\nimport { useGlobalLang } from '../../components/lang/useGlobalLang'\r\nimport Hyperlink from '../../components/utils/Hyperlink.vue'\r\nimport PageLayout from '../../layouts/page-layout/PageLayout.vue'\r\n\r\nconst form = useForm({\r\n  url: '',\r\n})\r\n\r\nconst lang = useGlobalLang()\r\n\r\nconst origin = window.location.origin\r\n\r\nconst router = useRouter()\r\n\r\nasync function submit(event: Event) {\r\n  formSubmit(form, event, async ({ url }) => {\r\n    router.push({ path: `/manuals/${url}` })\r\n  })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <PageLayout>\r\n    <div class=\"flex h-full max-w-3xl flex-col justify-center\">\r\n      <Head>\r\n        <title v-if=\"lang.isZh()\">手册</title>\r\n        <title v-else>Manual</title>\r\n      </Head>\r\n\r\n      <form @submit.prevent=\"submit\">\r\n        <FormInput name=\"url\" type=\"url\" :form=\"form\">\r\n          <template #label>\r\n            <div\r\n              class=\"flex items-end justify-between\"\r\n              title=\"Manual | Readonly.Link Manual\"\r\n            >\r\n              <Lang class=\"text-2xl font-bold\">\r\n                <template #zh> 手册 </template>\r\n                <template #en> Manual </template>\r\n              </Lang>\r\n              <Hyperlink\r\n                :href=\"\r\n                  lang.isZh()\r\n                    ? `/manuals/${origin}/contents/manual/zh.json/-/kinds-of-contents/manual.md`\r\n                    : `/manuals/${origin}/contents/manual/en.json/-/kinds-of-contents/manual.md`\r\n                \"\r\n              >\r\n                <QuestionMarkCircleIcon class=\"h-6 w-6\" />\r\n              </Hyperlink>\r\n            </div>\r\n          </template>\r\n\r\n          <template #input-end>\r\n            <button class=\"px-4\">\r\n              <PlayIcon class=\"w-6\" />\r\n            </button>\r\n          </template>\r\n        </FormInput>\r\n      </form>\r\n\r\n      <div class=\"py-16\"></div>\r\n    </div>\r\n  </PageLayout>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { Bars3Icon } from '@heroicons/vue/24/outline'\r\nimport { ref, watch } from 'vue'\r\nimport ManualPageNav from './ManualPageNav.vue'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst showNav = ref(false)\r\n\r\nconst slotElement = ref<HTMLElement | undefined>(undefined)\r\nconst slotElementMobile = ref<HTMLElement | undefined>(undefined)\r\n\r\nwatch(\r\n  () => props.state.path,\r\n  () => {\r\n    if (slotElement.value) {\r\n      slotElement.value.scrollTo(0, 0)\r\n    }\r\n\r\n    if (slotElementMobile.value) {\r\n      slotElementMobile.value.scrollTo(0, 0)\r\n    }\r\n  },\r\n  {\r\n    immediate: true,\r\n  },\r\n)\r\n</script>\r\n\r\n<template>\r\n  <div class=\"h-screen-dynamic flex flex-col\">\r\n    <div class=\"hidden h-full overflow-y-auto sm:block\">\r\n      <div class=\"flex h-full overflow-y-auto\">\r\n        <ManualPageNav :state class=\"overflow-y-auto\" style=\"width: 420px\" />\r\n\r\n        <div ref=\"slotElement\" class=\"w-full overflow-y-auto\">\r\n          <slot />\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"flex h-full flex-col sm:hidden\">\r\n      <div class=\"flex overflow-y-auto\">\r\n        <ManualPageNav\r\n          v-if=\"showNav\"\r\n          :state\r\n          class=\"fixed z-20 h-full w-5/6 overflow-y-auto bg-white\"\r\n        />\r\n\r\n        <div ref=\"slotElementMobile\" class=\"w-full overflow-y-auto\">\r\n          <slot />\r\n        </div>\r\n      </div>\r\n\r\n      <button\r\n        class=\"fixed bottom-6 right-6 z-20 block rounded-full border border-stone-400 bg-white p-3 sm:hidden dark:bg-black\"\r\n        @click=\"showNav = !showNav\"\r\n        v-on-click-outside=\"\r\n          () => {\r\n            showNav = false\r\n          }\r\n        \"\r\n      >\r\n        <Bars3Icon class=\"w-7 text-stone-500 dark:text-stone-300\" />\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n","import { State } from './State'\r\n\r\nexport function statePaths(state: State): Array<string> {\r\n  return Object.keys(state.texts)\r\n}\r\n","import { State } from './State'\r\nimport { statePaths } from './statePaths'\r\n\r\nexport function stateNextPath(state: State): string | undefined {\r\n  if (state.path === undefined) {\r\n    return undefined\r\n  }\r\n\r\n  const paths = statePaths(state)\r\n  const index = paths.indexOf(state.path)\r\n  return paths[index + 1]\r\n}\r\n","import { State } from './State'\r\nimport { statePaths } from './statePaths'\r\n\r\nexport function statePrevPath(state: State): string | undefined {\r\n  if (state.path === undefined) {\r\n    return undefined\r\n  }\r\n\r\n  const paths = statePaths(state)\r\n  const index = paths.indexOf(state.path)\r\n  return paths[index - 1]\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { Document } from '@xieyuheng/x-markdown'\r\nimport { join } from 'path-browserify'\r\nimport { computed } from 'vue'\r\nimport MdPage from '../../components/md/MdPage.vue'\r\nimport ManualPageEnding from './ManualPageEnding.vue'\r\nimport { State } from './State'\r\n\r\nconst props = defineProps<{\r\n  state: State\r\n  document: Document\r\n}>()\r\n\r\nconst url = computed(() => {\r\n  if (props.state.path === undefined) {\r\n    return new URL(props.state.url)\r\n  }\r\n\r\n  return new URL(\r\n    join(props.state.config.src, props.state.path),\r\n    props.state.url,\r\n  )\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex max-w-3xl flex-col px-6 sm:px-10 xl:mx-auto\">\r\n    <MdPage :key=\"state.path\" :document=\"document\" :url=\"url\" />\r\n    <ManualPageEnding class=\"py-6\" :state />\r\n  </div>\r\n</template>\r\n","import { Document } from '@xieyuheng/x-markdown'\r\nimport { State } from './State'\r\n\r\nexport function stateCurrentDocument(state: State): Document | undefined {\r\n  if (state.path === undefined) {\r\n    return undefined\r\n  }\r\n\r\n  return state.documents[state.path]\r\n}\r\n","import qs from 'qs'\r\nimport { watch } from 'vue'\r\nimport { Router } from 'vue-router'\r\nimport { State } from './State'\r\n\r\nfunction currentQuery() {\r\n  const url = new URL(window.location.href)\r\n  const query = qs.parse(url.search, { ignoreQueryPrefix: true })\r\n  return query\r\n}\r\n\r\nexport function stateReactivelyUpdateRoute(state: State, router: Router): void {\r\n  watch(\r\n    () => state.path,\r\n    (value) => {\r\n      if (value === undefined) {\r\n        router.replace({\r\n          path: `/manuals/${state.url}`,\r\n          query: {\r\n            ...(currentQuery() as any),\r\n          },\r\n        })\r\n      } else {\r\n        router.replace({\r\n          path: `/manuals/${state.url}/-/${value}`,\r\n          query: {\r\n            ...(currentQuery() as any),\r\n          },\r\n        })\r\n      }\r\n    },\r\n    {\r\n      immediate: true,\r\n    },\r\n  )\r\n}\r\n","import { z, ZodType } from 'zod'\r\n\r\nexport type ManualConfig = {\r\n  kind: 'Manual'\r\n  title: string\r\n  subtitle?: string\r\n  version?: string\r\n  authors: Array<string>\r\n  translators?: Array<string>\r\n  year?: string\r\n  date?: string\r\n  src: string\r\n  main: string\r\n  sections: Record<string, Array<string>>\r\n}\r\n\r\nexport const ManualConfigSchema: ZodType<ManualConfig> = z.object({\r\n  kind: z.literal('Manual'),\r\n  title: z.string(),\r\n  subtitle: z.optional(z.string()),\r\n  version: z.optional(z.string()),\r\n  authors: z.array(z.string()),\r\n  translators: z.optional(z.array(z.string())),\r\n  year: z.optional(z.string()),\r\n  date: z.optional(z.string()),\r\n  src: z.string(),\r\n  main: z.string(),\r\n  sections: z.record(z.string(), z.array(z.string())),\r\n})\r\n","import { ManualConfig, ManualConfigSchema } from './ManualConfig'\r\n\r\nexport async function loadManualConfig(options: {\r\n  url: string\r\n}): Promise<ManualConfig> {\r\n  const { url } = options\r\n\r\n  const response = await fetch(url)\r\n  const json = await response.json()\r\n\r\n  return ManualConfigSchema.parse(json)\r\n}\r\n","import { parseDocument } from '@xieyuheng/x-markdown'\r\nimport { join } from 'path-browserify'\r\nimport { useHistory } from '../../models/history/useHistory'\r\nimport { loadManualConfig } from '../../models/manual/loadManualConfig'\r\nimport { promiseAllFulfilled } from '../../utils/promiseAllFulfilled'\r\nimport { stringTrimEnd } from '../../utils/stringTrimEnd'\r\nimport { State } from './State'\r\n\r\nexport type StateOptions = {\r\n  url: string\r\n  path?: string\r\n}\r\n\r\nexport async function stateLoad(options: StateOptions): Promise<State> {\r\n  const url = stringTrimEnd(options.url, '/')\r\n  const config = await loadManualConfig({ url })\r\n  const path = options.path || config.main\r\n\r\n  const texts: Record<string, string> = Object.fromEntries(\r\n    await promiseAllFulfilled(\r\n      Object.values(config.sections).flatMap((paths) =>\r\n        paths.map(async (path) => {\r\n          const response = await fetch(new URL(join(config.src, path), url))\r\n          const text = await response.text()\r\n          return [path, text]\r\n        }),\r\n      ),\r\n    ),\r\n  )\r\n\r\n  const documents = Object.fromEntries(\r\n    Object.entries(texts).map(([path, text]) => [path, parseDocument(text)]),\r\n  )\r\n\r\n  const history = await useHistory()\r\n  history.record[url] = { time: Date.now(), url }\r\n\r\n  return {\r\n    url,\r\n    path,\r\n    config,\r\n    texts,\r\n    documents,\r\n  }\r\n}\r\n","import * as Kv from 'idb-keyval'\r\nimport { State } from './State'\r\nimport { stateLoad } from './stateLoad'\r\n\r\nexport async function stateRefresh(state: State): Promise<void> {\r\n  const store = Kv.createStore('readonly.link/manuals', 'cache')\r\n  const newState = await stateLoad(state)\r\n  delete newState.path\r\n  Object.assign(state, newState)\r\n  await Kv.set(state.url, newState, store)\r\n}\r\n","import { State } from './State'\r\nimport { stateCurrentDocument } from './stateCurrentDocument'\r\n\r\nexport function stateTitle(state: State): string {\r\n  const document = stateCurrentDocument(state)\r\n\r\n  if (document === undefined) {\r\n    return state.config.title\r\n  }\r\n\r\n  return [document.attributes.title, state.config.title].join(' | ')\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { useEventListener } from '@vueuse/core'\r\nimport { Head } from '@vueuse/head'\r\nimport { computed, onMounted, watchEffect } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport ManualLayout from './ManualLayout.vue'\r\nimport ManualPage from './ManualPage.vue'\r\nimport ManualPageNotFound from './ManualPageNotFound.vue'\r\nimport { State } from './State'\r\nimport { stateCurrentDocument } from './stateCurrentDocument'\r\nimport { stateNextPath } from './stateNextPath'\r\nimport { statePrevPath } from './statePrevPath'\r\nimport { stateReactivelyUpdateRoute } from './stateReactivelyUpdateRoute'\r\nimport { stateRefresh } from './stateRefresh'\r\nimport { stateTitle } from './stateTitle'\r\n\r\nconst props = defineProps<{ state: State }>()\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\nonMounted(async () => {\r\n  if (props.state.isLoadedFromCache) {\r\n    await stateRefresh(props.state)\r\n  }\r\n})\r\n\r\nstateReactivelyUpdateRoute(props.state, router)\r\n\r\nconst currentDocument = computed(() => stateCurrentDocument(props.state))\r\n\r\nwatchEffect(() => {\r\n  props.state.path = route.params.path\r\n    ? String(route.params.path)\r\n    : props.state.config.main\r\n})\r\n\r\nuseEventListener(window, 'keydown', (event) => {\r\n  if (event.altKey) return\r\n  if (event.ctrlKey) return\r\n\r\n  if (event.key === 'ArrowLeft') {\r\n    const path = statePrevPath(props.state)\r\n    if (path !== undefined) {\r\n      router.push(`/manuals/${props.state.url}/-/${path}`)\r\n    }\r\n  }\r\n\r\n  if (event.key === 'ArrowRight') {\r\n    const path = stateNextPath(props.state)\r\n    if (path !== undefined) {\r\n      router.push(`/manuals/${props.state.url}/-/${path}`)\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div\r\n    class=\"h-screen-dynamic overflow-auto bg-white text-black dark:bg-black dark:text-white\"\r\n  >\r\n    <Head>\r\n      <title>{{ stateTitle(state) }}</title>\r\n    </Head>\r\n\r\n    <ManualLayout :state>\r\n      <ManualPage v-if=\"currentDocument\" :state :document=\"currentDocument\" />\r\n      <ManualPageNotFound v-else :state />\r\n    </ManualLayout>\r\n  </div>\r\n</template>\r\n","import * as Kv from 'idb-keyval'\r\nimport { stringTrimEnd } from '../../utils/stringTrimEnd'\r\nimport { State } from './State'\r\nimport { StateOptions, stateLoad } from './stateLoad'\r\n\r\nexport async function stateLoadFromCacheFirst(\r\n  options: StateOptions,\r\n): Promise<State> {\r\n  const { path } = options\r\n  const url = stringTrimEnd(options.url, '/')\r\n\r\n  const store = Kv.createStore('readonly.link/manuals', 'cache')\r\n  const cached = await Kv.get(url, store)\r\n  if (cached) {\r\n    return {\r\n      ...cached,\r\n      path,\r\n      url,\r\n      isLoadedFromCache: true,\r\n    }\r\n  } else {\r\n    const state = await stateLoad(options)\r\n    await Kv.set(url, state, store)\r\n    return state\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { reactive, ref, watchEffect } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport ManualLoaded from './ManualLoaded.vue'\r\nimport ManualLoading from './ManualLoading.vue'\r\nimport { State } from './State'\r\nimport { stateLoadFromCacheFirst } from './stateLoadFromCacheFirst'\r\n\r\nconst route = useRoute()\r\n\r\nconst state = ref<State | undefined>(undefined)\r\n\r\nfunction useStateOptions() {\r\n  const url = String(route.params.url)\r\n  const path = route.params.path ? String(route.params.path) : undefined\r\n\r\n  return {\r\n    url,\r\n    path,\r\n  }\r\n}\r\n\r\nwatchEffect(async () => {\r\n  state.value = reactive(await stateLoadFromCacheFirst(useStateOptions()))\r\n})\r\n</script>\r\n\r\n<template>\r\n  <ManualLoaded v-if=\"state\" :state />\r\n  <ManualLoading v-else :options=\"useStateOptions()\" />\r\n</template>\r\n","import { RouteRecordRaw } from 'vue-router'\r\nimport About from './about/About.vue'\r\nimport ArticleEntrance from './article-entrance/ArticleEntrance.vue'\r\nimport Article from './article/Article.vue'\r\nimport AuthorList from './author-list/AuthorList.vue'\r\nimport Author from './author/Author.vue'\r\nimport BookEntrance from './book-entrance/BookEntrance.vue'\r\nimport Book from './book/Book.vue'\r\nimport EmbeddedArticle from './embedded-article//EmbeddedArticle.vue'\r\nimport PageNotFound from './errors/PageNotFound.vue'\r\nimport Following from './following/Following.vue'\r\nimport History from './history/History.vue'\r\nimport Home from './home/Home.vue'\r\nimport ManualEntrance from './manual-entrance/ManualEntrance.vue'\r\nimport Manual from './manual/Manual.vue'\r\n\r\nexport const routes: Array<RouteRecordRaw> = [\r\n  { path: '/', component: Home },\r\n  { path: '/about', component: About },\r\n\r\n  { path: '/authors', component: AuthorList },\r\n  { path: '/authors/', component: AuthorList },\r\n  { path: '/authors/:url(.*)', component: Author },\r\n  { path: '/authors/:url(.*)/-/:path(.*)', component: Author },\r\n\r\n  { path: '/articles', component: ArticleEntrance },\r\n  { path: '/articles/', component: ArticleEntrance },\r\n  { path: '/articles/:url(.*)', component: Article },\r\n\r\n  { path: '/embedded-article', component: EmbeddedArticle },\r\n\r\n  { path: '/books', component: BookEntrance },\r\n  { path: '/books/', component: BookEntrance },\r\n  { path: '/books/:url(.*)', component: Book },\r\n  { path: '/books/:url(.*)/-/:path(.*)', component: Book },\r\n\r\n  { path: '/manuals', component: ManualEntrance },\r\n  { path: '/manuals/', component: ManualEntrance },\r\n  { path: '/manuals/:url(.*)', component: Manual },\r\n  { path: '/manuals/:url(.*)/-/:path(.*)', component: Manual },\r\n\r\n  { path: '/history', component: History },\r\n  { path: '/following', component: Following },\r\n\r\n  { path: '/:pathMatch(.*)', component: PageNotFound },\r\n]\r\n","import { createRouter, createWebHistory } from 'vue-router'\r\nimport { routes } from '../pages/routes'\r\n\r\nconst router = createRouter({\r\n  history: createWebHistory(import.meta.env.BASE_URL),\r\n  routes,\r\n})\r\n\r\nexport default router\r\n","import { createHead } from '@vueuse/head'\r\nimport { createApp } from 'vue'\r\nimport App from './App.vue'\r\nimport { happyHacking } from './console/happyHacking'\r\nimport * as Directives from './directives'\r\nimport router from './router'\r\nimport './styles/index.css'\r\n\r\nconst app = createApp(App)\r\n\r\napp.use(router)\r\napp.use(createHead())\r\n\r\napp.directive('focus', Directives.focus)\r\napp.directive('blur', Directives.blur)\r\napp.directive('on-click-outside', Directives.onClickOutside)\r\n\r\napp.mount('#app')\r\n\r\nhappyHacking()\r\n"],"file":"assets/index-CDaOjwXr.js"}